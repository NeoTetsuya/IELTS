<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IELTS Academic Test Simulator - Cambridge 13 Test 2</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            overscroll-behavior: none;
        }
        .ielts-container {
            display: grid;
            grid-template-rows: auto 1fr auto;
            height: 100vh;
        }
        .content-panes {
            display: grid;
            grid-template-columns: 1fr 5px 1fr;
            overflow: hidden;
        }
        .questions-section {
            width: 100%;
        }
        .script-section {
            width: 100%;
            background-color: #faf5ff;
            border-radius: 0.5rem;
            padding: 1rem;
            border: 2px solid #e9d5ff;
            display: flex;
            flex-direction: column;
            overflow-y: auto;
        }
        .script-section.hidden {
            display: none !important;
        }
        .pane {
            overflow-y: auto;
            padding: 1.5rem;
        }
        .splitter {
            background-color: #d1d5db;
            cursor: col-resize;
            z-index: 10;
        }
        .tab-btn {
            padding: 8px 16px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            background-color: #f9fafb;
            cursor: pointer;
            transition: all 0.2s;
        }
        .tab-btn:hover {
            background-color: #f3f4f6;
        }
        .tab-btn.active {
            background-color: #3b82f6;
            color: white;
            border-color: #3b82f6;
        }
        .section-btn {
            padding: 6px 12px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            background-color: #f9fafb;
            cursor: pointer;
            transition: all 0.2s;
            margin: 0 4px;
        }
        .section-btn:hover {
            background-color: #e5e7eb;
        }
        .section-btn.active {
            background-color: #1d4ed8;
            color: white;
            border-color: #1d4ed8;
        }
        .play-audio-btn {
            display: inline-flex;
            align-items: center;
            padding: 10px 20px;
            background-color: #2563eb;
            color: white;
            border-radius: 8px;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .play-audio-btn:hover {
            background-color: #1d4ed8;
        }
        .play-audio-btn:disabled {
            background-color: #9ca3af;
            cursor: not-allowed;
        }
        .highlight-tooltip {
            position: absolute;
            background-color: #1f2937;
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 12px;
            z-index: 100;
            cursor: pointer;
            display: none;
        }
        mark {
            background-color: #fef08a;
            border-radius: 2px;
        }
        input[type="text"] {
            border: 1px solid #9ca3af;
            border-radius: 4px;
            padding: 4px 8px;
            width: 150px;
        }
        input[type="text"]:focus {
            outline: 2px solid #3b82f6;
            border-color: #3b82f6;
        }
        .audio-seeker {
            -webkit-appearance: none;
            appearance: none;
            background: #e5e7eb;
            outline: none;
            border-radius: 0.5rem;
        }
        .audio-seeker::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 16px;
            height: 16px;
            background: #3b82f6;
            cursor: pointer;
            border-radius: 50%;
        }
        .audio-seeker::-moz-range-thumb {
            width: 16px;
            height: 16px;
            background: #3b82f6;
            cursor: pointer;
            border-radius: 50%;
            border: none;
        }
        .question-highlight {
            background-color: #fef08a;
            color: #92400e;
            font-weight: bold;
            padding: 2px 6px;
            border-radius: 4px;
            border: 2px solid #f59e0b;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            display: inline-block;
            margin: 0 2px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .question-highlight:hover {
            background-color: #fde047;
            border-color: #d97706;
            transform: scale(1.05);
        }
        .reading-passage {
            line-height: 1.8;
            font-size: 16px;
            color: #374151;
            text-align: justify;
            margin-bottom: 2rem;
        }
        .reading-passage p {
            margin-bottom: 1.5rem;
            text-indent: 1.5rem;
        }
        .reading-passage h3, .reading-passage h4 {
            color: #1f2937;
            margin-bottom: 1rem;
            font-weight: 600;
        }
        .explanation-box {
            animation: fadeIn 0.3s ease-in-out;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .explanation-box:hover {
            background-color: #dbeafe !important;
            transform: scale(1.02);
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .correct-answer {
            box-shadow: 0 0 0 2px #16a34a;
        }
        .incorrect-answer {
            box-shadow: 0 0 0 2px #dc2626;
        }
        .passage-answer-highlight {
            background-color: #fef08a;
            border-bottom: 3px solid #f59e0b;
            padding: 2px 4px;
            border-radius: 3px;
            position: relative;
            display: inline-block;
            margin: 0 2px;
        }
        .passage-answer-highlight::after {
            content: attr(data-question);
            position: absolute;
            top: -20px;
            left: 50%;
            transform: translateX(-50%);
            background-color: #1f2937;
            color: white;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: bold;
            white-space: nowrap;
            z-index: 10;
            opacity: 0;
            transition: opacity 0.2s ease;
        }
        .passage-answer-highlight:hover::after {
            opacity: 1;
        }
        mark {
            cursor: pointer;
            transition: all 0.2s ease;
            border-radius: 2px;
            padding: 1px 2px;
        }
        mark:hover {
            background-color: #fde047 !important;
            transform: scale(1.02);
        }
        .vocab-word {
            cursor: help;
            border-bottom: 1px dotted #3b82f6;
            color: #1e40af;
            transition: all 0.2s ease;
        }
        .vocab-word:hover {
            background-color: #dbeafe;
            border-bottom-color: #1e40af;
        }
        .reading-passage {
            user-select: text;
        }
        .reading-passage.selecting {
            background-color: rgba(59, 130, 246, 0.05);
        }
        .vocab-tooltip {
            position: absolute;
            background: linear-gradient(135deg, #1e40af 0%, #3b82f6 100%);
            color: white;
            padding: 16px;
            border-radius: 12px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            max-width: 350px;
            font-size: 14px;
            line-height: 1.5;
            opacity: 0;
            transform: translateY(10px);
            transition: all 0.3s ease;
            pointer-events: auto;
            user-select: none;
        }
        .vocab-tooltip.show {
            opacity: 1;
            transform: translateY(0);
        }
        .vocab-tooltip::before {
            content: '';
            position: absolute;
            top: -8px;
            left: 20px;
            width: 0;
            height: 0;
            border-left: 8px solid transparent;
            border-right: 8px solid transparent;
            border-bottom: 8px solid #1e40af;
        }
        .vocab-word-text {
            font-weight: bold;
            font-size: 16px;
            margin-bottom: 8px;
            color: #fbbf24;
        }
        .vocab-pronunciation {
            font-style: italic;
            color: #e5e7eb;
            margin-bottom: 4px;
        }
        .vocab-ipa {
            font-family: 'Times New Roman', serif;
            color: #d1d5db;
            margin-bottom: 8px;
        }
        .vocab-definition {
            margin-bottom: 8px;
        }
        .vocab-synonyms {
            border-top: 1px solid rgba(255, 255, 255, 0.2);
            padding-top: 8px;
            margin-top: 8px;
        }
        .vocab-synonyms-title {
            font-weight: bold;
            color: #fbbf24;
            margin-bottom: 4px;
        }
        .vocab-audio-btn {
            background: #fbbf24;
            color: #1e40af;
            border: none;
            border-radius: 50%;
            width: 32px;
            height: 32px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            margin-left: 8px;
            transition: all 0.2s ease;
            font-size: 14px;
        }
        .vocab-audio-btn:hover {
            background: #f59e0b;
            transform: scale(1.1);
        }
        .vocab-audio-btn:active {
            transform: scale(0.95);
        }
        .vocab-audio-btn.playing {
            background: #10b981;
            animation: pulse 1s infinite;
        }
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

<div id="test-container" class="ielts-container">
    <!-- Header -->
    <header class="bg-white shadow-md p-3 flex justify-between items-center">
        <h1 class="text-xl font-bold text-blue-600">IELTS Academic Test Simulator - Cambridge 13 Test 2</h1>
        <div class="flex items-center space-x-4">
            <div class="text-lg font-semibold text-gray-600">IELTS Academic Test - Cambridge 13 Test 2</div>
                <button id="toggle-script-btn" class="bg-purple-600 text-white font-bold py-2 px-4 rounded-md hover:bg-purple-700 transition-colors">
                    Show Script
                </button>
        </div>
    </header>

    <!-- Main Content -->
    <main id="content-panes" class="content-panes">
        <!-- Left Pane: Passages / Instructions -->
        <div id="left-pane" class="pane bg-white">
            <!-- Content will be loaded here by JS -->
        </div>

        <!-- Splitter -->
        <div id="splitter" class="splitter"></div>

        <!-- Right Pane: Questions (Reading) or Script (Listening) -->
        <div id="right-pane" class="pane bg-gray-50">
            <!-- Questions Section (for Reading) -->
            <div id="questions-section" class="questions-section">
                <!-- Questions will be loaded here by JS -->
            </div>
            
            <!-- Script Section (for Listening) -->
            <div id="script-section" class="script-section">
                <div class="mb-4">
                    <h3 class="text-lg font-bold text-purple-800 mb-2">Listening Script</h3>
                    <p class="text-sm text-gray-600">Complete dialogue for the current listening section</p>
                </div>
                <div id="script-content" class="text-sm leading-relaxed overflow-y-auto" style="max-height: calc(100vh - 200px);">
                    <div class="text-gray-500">Script will load here when you click "Show Script"</div>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer: Navigation -->
    <footer class="bg-white shadow-inner p-3">
        <div class="flex justify-between items-center">
            <!-- Main Skill Tabs -->
            <div>
                <button class="tab-btn active" data-tab="listening">Listening</button>
                <button class="tab-btn" data-tab="reading">Reading</button>
                <button class="tab-btn" data-tab="vocabulary">Vocabulary Quiz</button>
            </div>
            <!-- Section Tabs -->
            <div id="section-tabs">
                <!-- Section buttons will be loaded here by JS -->
            </div>
        </div>
    </footer>
</div>

<!-- Highlight Tooltip -->
<div id="highlight-tooltip" class="highlight-tooltip">Highlight</div>

<!-- Vocabulary Tooltip -->
<div id="vocab-tooltip" class="vocab-tooltip">
    <div class="vocab-word-text">
        <span class="vocab-word-display"></span>
        <button class="vocab-audio-btn" title="Click to hear pronunciation">🔊</button>
    </div>
    <div class="vocab-pronunciation"></div>
    <div class="vocab-ipa"></div>
    <div class="vocab-definition"></div>
    <div class="vocab-synonyms">
        <div class="vocab-synonyms-title">Synonyms:</div>
        <div class="vocab-synonyms-list"></div>
    </div>
</div>


<script>
    // --- DATA ---
    const testData = {
        listening: {
            duration: 1800, // 30 minutes
            sections: [
                {
                    title: "Section 1",
                    instructions: `
                        <h3 class="text-lg font-bold mb-4">Listening Section 1</h3>
                        <p class="mb-4">You will hear a conversation about a cycling club.</p>
                        <div class="p-4 bg-blue-100 rounded-lg">
                            <p class="font-semibold mb-2">Audio Control</p>
                            <audio id="audio-sec1" src="https://s4-media1.study4.com/media/ielts_media/sound/08_Cam13-Test2-Section1.mp3" preload="metadata"></audio>
                            <div class="flex items-center space-x-3 mb-3">
                                <button data-audio-id="audio-sec1" class="play-audio-btn bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition-colors">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2 inline" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z" clip-rule="evenodd" /></svg>
                                    <span class="play-text">Play</span>
                                </button>
                                <span class="time-display text-sm text-gray-600">0:00 / 0:00</span>
                            </div>
                            <div class="w-full">
                                <input type="range" class="audio-seeker w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer" min="0" max="100" value="0">
                            </div>
                        </div>
                    `,
                    questions: `
                        <h4 class="font-bold mb-2 mt-6">Questions 1-10</h4>
                        <p class="mb-4">Complete the notes below. Write <strong>ONE WORD AND/OR A NUMBER</strong> for each answer.</p>
                        <div class="space-y-3 p-4 border rounded-lg bg-white">
                            <h5 class="font-bold text-center text-lg">South City Cycling Club</h5>
                            <p><strong>Example:</strong> Name of club secretary: Jim Hunter</p>
                            <p><strong>Membership</strong></p>
                            <ul>
                                <li>Full membership costs $260; this covers cycling and <strong>1</strong> <input type="text" id="q1" data-q="1"> all over Australia</li>
                                <li>Recreational membership costs $108</li>
                                <li>Cost of membership includes the club fee and <strong>2</strong> <input type="text" id="q2" data-q="2"></li>
                                <li>The club kit is made by a company called <strong>3</strong> <input type="text" id="q3" data-q="3"></li>
                            </ul>
                            <p><strong>Training rides</strong></p>
                            <ul>
                                <li>Chance to improve cycling skills and fitness</li>
                                <li>Level B: speed about <strong>4</strong> <input type="text" id="q4" data-q="4"> kph</li>
                            </ul>
                            <p><strong>Weekly sessions</strong></p>
                            <ul>
                                <li>Tuesdays at 5.30 am, meet at the <strong>5</strong> <input type="text" id="q5" data-q="5"></li>
                                <li>Thursdays at 5.30 am, meet at the entrance to the <strong>6</strong> <input type="text" id="q6" data-q="6"></li>
                            </ul>
                            <p><strong>Further information</strong></p>
                            <ul>
                                <li>Rides are about an hour and a half</li>
                                <li>Members often have <strong>7</strong> <input type="text" id="q7" data-q="7"> together afterwards</li>
                                <li>There is not always a <strong>8</strong> <input type="text" id="q8" data-q="8"> with the group on these rides</li>
                                <li>Check and print the <strong>9</strong> <input type="text" id="q9" data-q="9"> on the website beforehand</li>
                                <li>Bikes must have <strong>10</strong> <input type="text" id="q10" data-q="10"></li>
                            </ul>
                        </div>
                    `
                },
                {
                    title: "Section 2",
                    instructions: `
                        <h3 class="text-lg font-bold mb-4">Listening Section 2</h3>
                        <p class="mb-4">You will hear information about company volunteering projects.</p>
                        <div class="p-4 bg-blue-100 rounded-lg">
                            <p class="font-semibold mb-2">Audio Control</p>
                            <audio id="audio-sec2" src="https://s4-media1.study4.com/media/ielts_media/sound/08_Cam13-Test2-Section2.mp3" preload="metadata"></audio>
                            <div class="flex items-center space-x-3 mb-3">
                                <button data-audio-id="audio-sec2" class="play-audio-btn bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition-colors">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2 inline" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z" clip-rule="evenodd" /></svg>
                                    <span class="play-text">Play</span>
                                </button>
                                <span class="time-display text-sm text-gray-600">0:00 / 0:00</span>
                            </div>
                            <div class="w-full">
                                <input type="range" class="audio-seeker w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer" min="0" max="100" value="0">
                            </div>
                        </div>
                    `,
                    questions: `
                        <h4 class="font-bold mb-2 mt-6">Questions 11-20</h4>
                        <p class="mb-4">Choose the correct letter, <strong>A, B or C</strong>.</p>
                        <div class="space-y-4 p-4 border rounded-lg bg-white mb-6">
                            <div class="q-item">
                                <p><strong>11</strong> How much time for volunteering does the company allow per employee?</p>
                                <label class="block"><input type="radio" name="q11" value="A"> A two hours per week</label>
                                <label class="block"><input type="radio" name="q11" value="B"> B one day per month</label>
                                <label class="block"><input type="radio" name="q11" value="C"> C 8 hours per year</label>
                            </div>
                            <div class="q-item">
                                <p><strong>12</strong> In feedback almost all employees said that volunteering improved their</p>
                                <label class="block"><input type="radio" name="q12" value="A"> A chances of promotion.</label>
                                <label class="block"><input type="radio" name="q12" value="B"> B job satisfaction.</label>
                                <label class="block"><input type="radio" name="q12" value="C"> C relationships with colleagues.</label>
                            </div>
                            <div class="q-item">
                                <p><strong>13</strong> Last year some staff helped unemployed people with their</p>
                                <label class="block"><input type="radio" name="q13" value="A"> A literacy skills.</label>
                                <label class="block"><input type="radio" name="q13" value="B"> B job applications.</label>
                                <label class="block"><input type="radio" name="q13" value="C"> C communication skills.</label>
                            </div>
                            <div class="q-item">
                                <p><strong>14</strong> This year the company will start a new volunteering project with a local</p>
                                <label class="block"><input type="radio" name="q14" value="A"> A school.</label>
                                <label class="block"><input type="radio" name="q14" value="B"> B park.</label>
                                <label class="block"><input type="radio" name="q14" value="C"> C charity.</label>
                            </div>
                            <div class="q-item">
                                <p><strong>15</strong> Where will the Digital Inclusion Day be held?</p>
                                <label class="block"><input type="radio" name="q15" value="A"> A at the company's training facility</label>
                                <label class="block"><input type="radio" name="q15" value="B"> B at a college</label>
                                <label class="block"><input type="radio" name="q15" value="C"> C in a community centre</label>
                            </div>
                            <div class="q-item">
                                <p><strong>16</strong> What should staff do if they want to take part in the Digital Inclusion Day?</p>
                                <label class="block"><input type="radio" name="q16" value="A"> A fill in a form</label>
                                <label class="block"><input type="radio" name="q16" value="B"> B attend a training workshop</label>
                                <label class="block"><input type="radio" name="q16" value="C"> C get permission from their manager</label>
                            </div>
                        </div>
                        <h4 class="font-bold mb-2">Questions 17-18</h4>
                        <p class="mb-4">Choose <strong>TWO letters, A-E</strong>.</p>
                        <p class="mb-4">What TWO things are mentioned about the participants on the last Digital Inclusion Day?</p>
                        <div class="space-y-2 p-4 border rounded-lg bg-white mb-6">
                            <label class="block"><input type="checkbox" name="q17" value="A"> A They were all over 70.</label>
                            <label class="block"><input type="checkbox" name="q17" value="B"> B They never used their computer.</label>
                            <label class="block"><input type="checkbox" name="q17" value="C"> C Their phones were mostly old-fashioned.</label>
                            <label class="block"><input type="checkbox" name="q17" value="D"> D They only used their phones for making calls.</label>
                            <label class="block"><input type="checkbox" name="q17" value="E"> E They initially showed little interest.</label>
                        </div>
                        <h4 class="font-bold mb-2">Questions 19-20</h4>
                        <p class="mb-4">Choose <strong>TWO letters, A-E</strong>.</p>
                        <p class="mb-4">What TWO activities on the last Digital Inclusion Day did participants describe as useful?</p>
                        <div class="space-y-2 p-4 border rounded-lg bg-white">
                            <label class="block"><input type="checkbox" name="q19" value="A"> A learning to use tablets</label>
                            <label class="block"><input type="checkbox" name="q19" value="B"> B communicating with family</label>
                            <label class="block"><input type="checkbox" name="q19" value="C"> C shopping online</label>
                            <label class="block"><input type="checkbox" name="q19" value="D"> D playing online games</label>
                            <label class="block"><input type="checkbox" name="q19" value="E"> E sending emails</label>
                        </div>
                    `
                },
                {
                    title: "Section 3",
                    instructions: `
                        <h3 class="text-lg font-bold mb-4">Listening Section 3</h3>
                        <p class="mb-4">You will hear a conversation between two students planning a presentation on nanotechnology.</p>
                        <div class="p-4 bg-blue-100 rounded-lg">
                            <p class="font-semibold mb-2">Audio Control</p>
                            <audio id="audio-sec3" src="https://s4-media1.study4.com/media/ielts_media/sound/08_Cam13-Test2-Section3.mp3" preload="metadata"></audio>
                            <div class="flex items-center space-x-3 mb-3">
                                <button data-audio-id="audio-sec3" class="play-audio-btn bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition-colors">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2 inline" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z" clip-rule="evenodd" /></svg>
                                    <span class="play-text">Play</span>
                                </button>
                                <span class="time-display text-sm text-gray-600">0:00 / 0:00</span>
                            </div>
                            <div class="w-full">
                                <input type="range" class="audio-seeker w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer" min="0" max="100" value="0">
                            </div>
                        </div>
                    `,
                    questions: `
                        <h4 class="font-bold mb-2 mt-6">Questions 21-30</h4>
                        <p class="mb-4">Choose the correct letter, <strong>A, B or C</strong>.</p>
                        <div class="space-y-4 p-4 border rounded-lg bg-white">
                            <div class="q-item">
                                <p><strong>21</strong> Russ says that his difficulty in planning the presentation is due to</p>
                                <label class="block"><input type="radio" name="q21" value="A"> A his lack of knowledge about the topic.</label>
                                <label class="block"><input type="radio" name="q21" value="B"> B his uncertainty about what he should try to achieve.</label>
                                <label class="block"><input type="radio" name="q21" value="C"> C the short time that he has for preparation.</label>
                            </div>
                            <div class="q-item">
                                <p><strong>22</strong> Russ and his tutor agree that his approach in the presentation will be</p>
                                <label class="block"><input type="radio" name="q22" value="A"> A to concentrate on how nanotechnology is used in one field.</label>
                                <label class="block"><input type="radio" name="q22" value="B"> B to follow the chronological development of nanotechnology.</label>
                                <label class="block"><input type="radio" name="q22" value="C"> C to show the range of applications of nanotechnology.</label>
                            </div>
                            <div class="q-item">
                                <p><strong>23</strong> In connection with slides, the tutor advises Russ to</p>
                                <label class="block"><input type="radio" name="q23" value="A"> A talk about things that he can find slides to illustrate.</label>
                                <label class="block"><input type="radio" name="q23" value="B"> B look for slides to illustrate the points he makes.</label>
                                <label class="block"><input type="radio" name="q23" value="C"> C consider omitting slides altogether.</label>
                            </div>
                            <div class="q-item">
                                <p><strong>24</strong> They both agree that the best way for Russ to start his presentation is</p>
                                <label class="block"><input type="radio" name="q24" value="A"> A to encourage the audience to talk.</label>
                                <label class="block"><input type="radio" name="q24" value="B"> B to explain what Russ intends to do.</label>
                                <label class="block"><input type="radio" name="q24" value="C"> C to provide an example.</label>
                            </div>
                            <div class="q-item">
                                <p><strong>25</strong> What does the tutor advise Russ to do next while preparing his presentation?</p>
                                <label class="block"><input type="radio" name="q25" value="A"> A summarise the main point he wants to make</label>
                                <label class="block"><input type="radio" name="q25" value="B"> B read the notes he has already made</label>
                                <label class="block"><input type="radio" name="q25" value="C"> C list the topics he wants to cover</label>
                            </div>
                        </div>
                        <h4 class="font-bold mb-2 mt-6">Questions 26-30</h4>
                        <p class="mb-4">What comments do the speakers make about each of the following aspects of Russ's previous presentation?</p>
                        <p class="mb-4">Choose <strong>FIVE answers from the box</strong> and write the correct letter, <strong>A-G</strong>, next to Questions 26-30.</p>
                        <div class="space-y-3 p-4 border rounded-lg bg-white">
                            <p><strong>26</strong> Structure <input type="text" maxlength="1" class="w-10 text-center" id="q26" data-q="26"></p>
                            <p><strong>27</strong> Eye contact <input type="text" maxlength="1" class="w-10 text-center" id="q27" data-q="27"></p>
                            <p><strong>28</strong> Body language <input type="text" maxlength="1" class="w-10 text-center" id="q28" data-q="28"></p>
                            <p><strong>29</strong> Choice of words <input type="text" maxlength="1" class="w-10 text-center" id="q29" data-q="29"></p>
                            <p><strong>30</strong> Handouts <input type="text" maxlength="1" class="w-10 text-center" id="q30" data-q="30"></p>
                            <div class="mt-4 p-2 bg-gray-100 rounded">
                                <p class="font-bold">Comments</p>
                                <p><strong>A</strong> lacked a conclusion</p>
                                <p><strong>B</strong> useful in the future</p>
                                <p><strong>C</strong> not enough</p>
                                <p><strong>D</strong> sometimes distracting</p>
                                <p><strong>E</strong> showed originality</p>
                                <p><strong>F</strong> covered a wide range</p>
                                <p><strong>G</strong> not too technical</p>
                            </div>
                        </div>
                    `
                },
                {
                    title: "Section 4",
                    instructions: `
                        <h3 class="text-lg font-bold mb-4">Listening Section 4</h3>
                        <p class="mb-4">You will hear a lecture on episodic memory.</p>
                        <div class="p-4 bg-blue-100 rounded-lg">
                            <p class="font-semibold mb-2">Audio Control</p>
                            <audio id="audio-sec4" src="https://s4-media1.study4.com/media/ielts_media/sound/08_Cam13-Test2-Section4.mp3" preload="metadata"></audio>
                            <div class="flex items-center space-x-3 mb-3">
                                <button data-audio-id="audio-sec4" class="play-audio-btn bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition-colors">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2 inline" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z" clip-rule="evenodd" /></svg>
                                    <span class="play-text">Play</span>
                                </button>
                                <span class="time-display text-sm text-gray-600">0:00 / 0:00</span>
                            </div>
                            <div class="w-full">
                                <input type="range" class="audio-seeker w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer" min="0" max="100" value="0">
                            </div>
                        </div>
                    `,
                    questions: `
                        <h4 class="font-bold mb-2 mt-6">Questions 31-40</h4>
                        <p class="mb-4">Complete the notes below. Write <strong>ONE WORD ONLY</strong> for each answer.</p>
                        <div class="space-y-3 p-4 border rounded-lg bg-white">
                            <h5 class="font-bold text-center text-lg">Episodic memory</h5>
                            <ul>
                                <li>the ability to recall details, e.g. the time and <strong>31</strong> <input type="text" id="q31" data-q="31"> of past events</li>
                                <li>different to semantic memory - the ability to remember general information about the <strong>32</strong> <input type="text" id="q32" data-q="32"> which does not involve recalling <strong>33</strong> <input type="text" id="q33" data-q="33"> information</li>
                            </ul>
                            <p><strong>Forming episodic memories involves three steps:</strong></p>
                            <p><strong>Encoding</strong></p>
                            <ul>
                                <li>involves receiving and processing information</li>
                                <li>the more <strong>34</strong> <input type="text" id="q34" data-q="34"> given to an event, the more successfully it can be encoded</li>
                                <li>to remember a <strong>35</strong> <input type="text" id="q35" data-q="35">, it is useful to have a strategy for encoding such information</li>
                            </ul>
                            <p><strong>Consolidation</strong></p>
                            <ul>
                                <li>how memories are strengthened and stored</li>
                                <li>most effective when memories can be added to a <strong>36</strong> <input type="text" id="q36" data-q="36"> of related information</li>
                                <li>the <strong>37</strong> <input type="text" id="q37" data-q="37"> of retrieval affects the strength of memories</li>
                                <li>memory retrieval often depends on using a prompt, e.g. the <strong>38</strong> <input type="text" id="q38" data-q="38"> of an object near to the place where you left your car</li>
                            </ul>
                            <p><strong>Episodic memory impairments</strong></p>
                            <ul>
                                <li>these affect people with a wide range of medical conditions</li>
                                <li>games which stimulate the <strong>39</strong> <input type="text" id="q39" data-q="39"> have been found to help people with schizophrenia</li>
                                <li>children with autism may have difficulty forming episodic memories - possibly because their concept of the <strong>40</strong> <input type="text" id="q40" data-q="40"> may be absent</li>
                                <li>memory training may help autistic children develop social skills</li>
                            </ul>
                        </div>
                    `
                }
            ]
        },
        reading: {
            duration: 3600, // 60 minutes
            sections: [
                {
                    title: "Passage 1",
                    passage: `
                        <h3 class="text-xl font-bold mb-4">Bringing cinnamon to Europe</h3>
                        <p class="mb-4">Cinnamon is a sweet, fragrant spice produced from the inner bark of trees of the genus Cinnamomum, which is native to the Indian sub-continent. It was known in biblical times, and is mentioned in several books of the Bible, both as an ingredient that was mixed with oils for anointing people's bodies, and also as a token indicating friendship among lovers and friends. In ancient Rome, mourners attending funerals burnt cinnamon to create a pleasant scent. Most often, however, the spice found its primary use as an additive to food and drink. In the Middle Ages, Europeans who could afford the spice used it to flavor food, particularly meat, and to impress those around them with their ability to purchase an expensive condiment from the 'exotic' East. At a banquet, a host would offer guests a plate with various spices piled upon it as a sign of the wealth at his or her disposal. Cinnamon was also reported to have health benefits, and was thought to cure various ailments, such as indigestion.</p>
                        <p class="mb-4">Toward the end of the Middle Ages, the European middle classes began to desire the lifestyle of the elite, including their consumption of spices. This led to a growth in demand for cinnamon and other spices. At that time, cinnamon was transported by Arab merchants, who closely guarded the secret of the source of the spice from potential rivals. They took it from India, where it was grown, on camels via an overland route to the Mediterranean. Their journey ended when they reached Alexandria. European traders sailed there to purchase their supply of cinnamon, then brought it back to Venice. The spice then travelled from that great trading city to markets all around Europe. Because the overland trade route allowed for only small quantities of the spice to reach Europe, and because Venice had a virtual monopoly of the trade, the Venetians could set the price of cinnamon exorbitantly high. These prices, coupled with the increasing demand, spurred the search for new routes to Asia by Europeans eager to take part in the spice trade.</p>
                        <p class="mb-4">Seeking the high profits promised by the cinnamon market, Portuguese traders arrived on the island of Ceylon in the Indian Ocean toward the end of the 15th century. Before Europeans arrived on the island, the state had organized the cultivation of cinnamon. People belonging to the ethnic group called the Salagama would peel the bark off young shoots of the cinnamon plant in the rainy season, when the wet bark was more pliable. During the peeling process, they curled the bark into the 'stick' shape still associated with the spice today. The Salagama then gave the finished product to the king as a form of tribute. When the Portuguese arrived, they needed to increase production significantly, and so enslaved many other members of the Ceylonese native population, forcing them to work in cinnamon harvesting. In 1518, the Portuguese built a fort on Ceylon, which enabled them to protect the island, so helping them to develop a monopoly in the cinnamon trade and generate very high profits. In the late 16th century, for example, they enjoyed a tenfold profit when shipping cinnamon over a journey of eight days from Ceylon to India.</p>
                        <p class="mb-4">When the Dutch arrived off the coast of southern Asia at the very beginning of the 17th century, they set their sights on displacing the Portuguese as kings of cinnamon. The Dutch allied themselves with Kandy, an inland kingdom on Ceylon. In return for payments of elephants and cinnamon, they protected the native king from the Portuguese. By 1649, the Dutch broke the 150-year Portuguese monopoly when they overran and occupied their factories. By 1658, they had permanently expelled the Portuguese from the island, thereby gaining control of the lucrative cinnamon trade.</p>
                        <p class="mb-4">In order to protect their hold on the market, the Dutch, like the Portuguese before them, treated the native inhabitants harshly. Because of the need to boost production and satisfy Europe's ever-increasing appetite for cinnamon, the Dutch began to alter the harvesting practices of the Ceylonese. Over time, the supply of cinnamon trees on the island became nearly exhausted, due to systematic stripping of the bark. Eventually, the Dutch began cultivating their own cinnamon trees to supplement the diminishing number of wild trees available for use.</p>
                        <p class="mb-4">Then, in 1796, the English arrived on Ceylon, thereby displacing the Dutch from their control of the cinnamon monopoly. By the middle of the 19th century, production of cinnamon reached 1,000 tons a year, after a lower grade quality of the spice became acceptable to European tastes. By that time, cinnamon was being grown in other parts of the Indian Ocean region and in the West Indies, Brazil, and Guyana. Not only was a monopoly of cinnamon becoming impossible, but the spice trade overall was diminishing in economic potential, and was eventually superseded by the rise of trade in coffee, tea, chocolate, and sugar.</p>
                    `,
                    questions: `
                        <h4 class="font-bold mb-2">Questions 1-9</h4>
                        <p class="mb-4">Complete the notes below. Choose <strong>ONE WORD ONLY</strong> from the passage for each answer.</p>
                        <div class="space-y-3 p-4 border rounded-lg bg-white mb-6">
                            <h5 class="font-bold text-center text-lg">The Early History of Cinnamon</h5>
                            <p><strong>Ancient times</strong></p>
                            <ul>
                                <li>Used in <strong>1</strong> <input type="text" id="q41" data-q="41"> ceremonies and as a sign of <strong>2</strong> <input type="text" id="q42" data-q="42"></li>
                                <li>Burnt at Roman <strong>3</strong> <input type="text" id="q43" data-q="43"></li>
                                <li>Used to flavor food and as a <strong>4</strong> <input type="text" id="q44" data-q="44"> of wealth</li>
                                <li>Believed to have <strong>5</strong> <input type="text" id="q45" data-q="45"> properties</li>
                            </ul>
                            <p><strong>Middle Ages</strong></p>
                            <ul>
                                <li>Demand increased as middle classes wanted to copy the <strong>6</strong> <input type="text" id="q46" data-q="46"></li>
                                <li>Transported by <strong>7</strong> <input type="text" id="q47" data-q="47"> merchants via <strong>8</strong> <input type="text" id="q48" data-q="48"> route</li>
                                <li>Venice had a <strong>9</strong> <input type="text" id="q49" data-q="49"> on the trade</li>
                            </ul>
                        </div>
                        <h4 class="font-bold mb-2">Questions 10-13</h4>
                        <p class="mb-4">Do the following statements agree with the information given in Reading Passage 1? Write <strong>TRUE</strong>, <strong>FALSE</strong>, or <strong>NOT GIVEN</strong>.</p>
                        <div class="space-y-3 p-4 border rounded-lg bg-white">
                            <p><strong>10</strong> The Portuguese had control over the cinnamon trade in Ceylon throughout the 16th century. <input type="text" id="q50" data-q="50"></p>
                            <p><strong>11</strong> The Dutch took over the cinnamon trade from the Portuguese as soon as they arrived in Ceylon. <input type="text" id="q51" data-q="51"></p>
                            <p><strong>12</strong> The trees planted by the Dutch produced larger quantities of cinnamon than the wild trees. <input type="text" id="q52" data-q="52"></p>
                            <p><strong>13</strong> The spice trade maintained its economic importance during the 19th century. <input type="text" id="q53" data-q="53"></p>
                        </div>
                    `
                },
                {
                    title: "Passage 2",
                    passage: `
                        <h3 class="text-xl font-bold mb-4">Oxytocin</h3>
                        <p class="mb-4">The positive and negative effects of the chemical known as the 'love hormone'</p>
                        <p class="mb-4"><strong>A.</strong> Oxytocin is a chemical, a hormone produced in the pituitary gland in the brain. It was through various studies focusing on animals that scientists first became aware of the influence of oxytocin. They discovered that it helps reinforce the bonds between prairie voles, which mate for life, and triggers the motherly behaviour that sheep show towards their newborn lambs. It is also released by women in childbirth, strengthening the attachment between mother and baby. Few chemicals have as positive a reputation as oxytocin, which is sometimes referred to as the 'love hormone'. One sniff of it can, it is claimed, make a person more trusting, empathetic, generous and cooperative. It is time, however, to revise this wholly optimistic view. A new wave of studies has shown that its effects vary greatly depending on the person and the circumstances, and it can impact on our social interactions for worse as well as for better.</p>
                        <p class="mb-4"><strong>B.</strong> Oxytocin's role in human behaviour first emerged in 2005. In a groundbreaking experiments, Markus Heinrichs and his colleagues at the University of Freiburg, Germany, asked volunteers to do an activity in which they could invest money with an anonymous person who was not guaranteed to be honest. The team found the participants who had sniffed oxytocin via a nasal spray beforehand invested more money than those who received a placebo instead. The study was the start of research into the effects of oxytocin on human interactions. 'For eight years, it was quite a lonesome field,' Heinrichs recalls. 'Now, everyone is interested.' These follow-up studies have shown that after a sniff of the hormone, people become more charitable, better at reading emotions on others' faces and at communicating constructively in arguments. Together, the results fuelled the view that oxytocin universally enhanced the positive aspects of our social nature.</p>
                        <p class="mb-4"><strong>C.</strong> Then, after a few years, contrasting findings began to emerge. Simone Shamay-Tsoory at the University of Haifa, Israel, found that when volunteers played a competitive game, those who inhaled the hormone showed more pleasure when they beat other players, and felt more envy when others won. What's more, administering oxytocin also has sharply contrasting outcomes depending on a person's disposition. Jennifer Bartz from Mount Sinai School of Medicine, New York, found that it improves people's ability to read emotions, but only if they are not very socially adept to begin with. Her research also shows that oxytocin in fact reduces cooperation in subjects who are particularly anxious or sensitive to rejection.</p>
                        <p class="mb-4"><strong>D.</strong> Another discovery is that oxytocin's effects vary depending on who we are interacting with. Studies conducted by Carolyn DeClerck of the University of Antwerp, Belgium, revealed that people who had received a dose of oxytocin actually became less cooperative when dealing with complete strangers. Meanwhile, Carsten De Dreu at the University of Amsterdam in the Netherlands discovered that volunteers given oxytocin showed favouritism: Dutch men became quicker to associate positive words with Dutch names than with foreign ones, for example. According to De Dreu, oxytocin drives people to care for those in their social circles and defend them from outside dangers. So, it appears that oxytocin strengthens biases, rather than promoting general goodwill, as was previously thought.</p>
                        <p class="mb-4"><strong>E.</strong> There were signs of these subtleties from the start. Bartz has recently shown that in almost half of the existing research results, oxytocin influenced only certain individuals or in certain circumstances. Where once researchers took no notice of such findings, now a more nuanced understanding of oxytocin's effects is propelling investigations down new lines. To Bartz, the key to understanding what the hormone does lies in pinpointing its core function rather than in cataloguing its seemingly endless effects. There are several hypotheses which are not mutually exclusive. Oxytocin could help to reduce anxiety and fear. Or it could simply motivate people to seek out social connections. She believes that oxytocin acts as a chemical spotlight that shines on social clues — a shift in posture, a flicker of the eyes, a dip in the voice — making people more attuned to their social environment. This would explain why it makes us more likely to look others in the eye and improves our ability to identify emotions. But it could also make things worse for people who are overly sensitive or prone to interpreting social cues in the worst light.</p>
                        <p class="mb-4"><strong>F.</strong> Perhaps we should not be surprised that the oxytocin story has become more perplexing. The hormone is found in everything from octopuses to sheep, and its evolutionary roots stretch back half a billion years. 'It's a very simple and ancient molecule that has been co-opted for many different functions,' says Sue Carter at the University of Illinois, Chicago, USA. 'It affects primitive parts of the brain like the amygdala, so it's going to have many effects on just about everything.' Bartz agrees. 'Oxytocin probably does some very basic things, but once you add our higher-order thinking and social situations, these basic processes could manifest in different ways depending on individual differences and context.'</p>
                    `,
                    questions: `
                        <h4 class="font-bold mb-2">Questions 14-17</h4>
                        <p class="mb-4">Which paragraph contains the following information? Write the correct letter, <strong>A-F</strong>, in boxes 14-17 on your answer sheet.</p>
                        <p class="mb-4"><strong>NB</strong> You may use any letter more than once.</p>
                        <div class="space-y-3 p-4 border rounded-lg bg-white mb-6">
                            <p><strong>14</strong> reference to research showing the beneficial effects of oxytocin on people <input type="text" maxlength="1" class="w-10 text-center" id="q54" data-q="54"></p>
                            <p><strong>15</strong> reasons why the effects of oxytocin are complex <input type="text" maxlength="1" class="w-10 text-center" id="q55" data-q="55"></p>
                            <p><strong>16</strong> mention of a period in which oxytocin attracted little scientific attention <input type="text" maxlength="1" class="w-10 text-center" id="q56" data-q="56"></p>
                            <p><strong>17</strong> reference to people ignoring certain aspects of their research data <input type="text" maxlength="1" class="w-10 text-center" id="q57" data-q="57"></p>
                        </div>
                        <h4 class="font-bold mb-2">Questions 18-20</h4>
                        <p class="mb-4">Look at the following research findings (Questions 18-20) and the list of researchers below.</p>
                        <p class="mb-4">Match each research finding with the correct researcher, <strong>A-F</strong>.</p>
                        <p class="mb-4">Write the correct letter, <strong>A-F</strong>, in boxes 18-20 on your answer sheet.</p>
                        <div class="space-y-3 p-4 border rounded-lg bg-white mb-6">
                            <p><strong>18</strong> People are more trusting when affected by oxytocin. <input type="text" maxlength="1" class="w-10 text-center" id="q58" data-q="58"></p>
                            <p><strong>19</strong> Oxytocin increases people's feelings of jealousy. <input type="text" maxlength="1" class="w-10 text-center" id="q59" data-q="59"></p>
                            <p><strong>20</strong> The effect of oxytocin varies from one type of person to another. <input type="text" maxlength="1" class="w-10 text-center" id="q60" data-q="60"></p>
                            <div class="mt-4 p-2 bg-gray-100 rounded">
                                <p class="font-bold">List of Researchers</p>
                                <p><strong>A</strong> Markus Heinrichs</p>
                                <p><strong>B</strong> Simone Shamay-Tsoory</p>
                                <p><strong>C</strong> Jennifer Bartz</p>
                                <p><strong>D</strong> Carolyn DeClerck</p>
                                <p><strong>E</strong> Carsten De Dreu</p>
                                <p><strong>F</strong> Sue Carter</p>
                            </div>
                        </div>
                        <h4 class="font-bold mb-2">Questions 21-26</h4>
                        <p class="mb-4">Complete the summary below. Choose <strong>ONE WORD ONLY</strong> from the passage for each answer.</p>
                        <p class="mb-4">Write your answers in boxes 21-26 on your answer sheet</p>
                        <div class="space-y-3 p-4 border rounded-lg bg-white">
                            <h5 class="font-bold text-center text-lg">Oxytocin research</h5>
                            <p>The earliest findings about oxytocin and bonding came from research involving <strong>21</strong> <input type="text" id="q61" data-q="61">. It was also discovered that humans produce oxytocin during <strong>22</strong> <input type="text" id="q62" data-q="62">. An experiment in 2005, in which participants were given either oxytocin or a <strong>23</strong> <input type="text" id="q63" data-q="63">, reinforced the belief that the hormone had a positive effect.</p>
                            <p>However, later research suggests that this is not always the case. A study at the University of Haifa where participants took part in a <strong>24</strong> <input type="text" id="q64" data-q="64"> revealed the negative emotions which oxytocin can trigger. A study at the University of Antwerp showed people's lack of willingness to help <strong>25</strong> <input type="text" id="q65" data-q="65"> while under the influence of oxytocin. Meanwhile, research at the University of Amsterdam revealed that people who have been given oxytocin consider <strong>26</strong> <input type="text" id="q66" data-q="66"> that are familiar to them in their own country to have more positive associations than those from other cultures.</p>
                        </div>
                    `
                },
                {
                    title: "Passage 3",
                    passage: `
                        <h3 class="text-xl font-bold mb-4">MAKING THE MOST OF TRENDS</h3>
                        <p class="mb-4">Experts from Harvard Business School give advice to managers</p>
                        <p class="mb-4">Most managers can identify the major trends of the day, But in the course of conducting research in a number of industries and working directly with companies, we have discovered that managers often fail to recognize the less obvious but profound ways these trends are influencing consumers' aspirations, attitudes, and behaviors. This is especially true of trends that managers view as peripheral to their core markets.</p>
                        <p class="mb-4">Many ignore trends in their innovation strategies or adopt a wait-and-see approach and let competitors take the lead. At a minimum, such responses mean missed profit opportunities. At the extreme, they can jeopardize a company by ceding to rivals the opportunity to transform the industry. The purpose of this article is twofold: to spur managers to think more expansively about how trends could engender new value propositions in their core markets, and to provide some high-level advice on how to make market research and product development personnel more adept at analyzing and exploiting trends.</p>
                        <p class="mb-4">One strategy, known as 'infuse and augment', is to design a product or service that retains most of the attributes and functions of existing products in the category but adds others that address the needs and desires unleashed by a major trend. A case in point in the Poppy range of handbags, which the firm Coach created in response to the economic downturn of 2008. The Coach brand had been a symbol of opulence and luxury for nearly 70 years, and the most obvious reaction to the downturn would have been to lower prices. However, that would have risked cheapening the brand's image. Instead, they initiated a consumer-research project which revealed that customers were eager to lift themselves and the country out of tough times. Using these insights, Coach launched the lower-priced Poppy handbags, which were in vibrant colors, and looked more youthful and playful than conventional Coach products. Creating the sub-brand allowed Coach to avert an across-the-board price cut. In contrast to the many companies that responded to the recession by cutting prices, Coach saw the new consumer mindset as an opportunity for innovation and renewal.</p>
                        <p class="mb-4">A further example of this strategy was supermarket Tesco's response to consumers' growing concerns about the environment. With that in mind, Tesco, one of the world's top five retailers, introduced its Greener Living program, which demonstrates the company's commitment to protecting the environment by involving consumers in ways that produce tangible results. For example, Tesco customers can accumulate points for such activities as reusing bags, recycling cans and printer cartridges, and buying home-insulation materials. Like points earned on regular purchases, these green points can be redeemed for cash. Tesco has not abandoned its traditional retail offering but augmented its business with these innovations, thereby infusing its value proposition with a green streak.</p>
                        <p class="mb-4">A more radical strategy is 'combine and transcend'. This entails combining aspects of the product's existing value proposition with attributes addressing changes arising from a trend, to create a novel experience — one that may land the company in an entirely new market space. At first glance, spending resources to incorporate elements of a seemingly irrelevant trend into ones core offerings sounds like it's hardly worthwhile. But consider Nike's move to integrate the digital revolution into its reputation for high-performance athletic footwear. In 2006, they teamed up with technology company Apple to launch Nike+, a digital sports kit comprising a sensor that attaches to the running shoe and a wireless receiver that connects to the user's iPod. By combining Nike's original value proposition for amateur athletes with one for digital consumers, the Nike+ sports kit and web interface moved the company from a focus on athletic apparel to a new plane of engagement with its customers.</p>
                        <p class="mb-4">A third approach, known as 'counteract and reaffirm', involves developing products or services that stress the values traditionally associated with the category in ways that allow consumers to oppose — or at least temporarily escape from — the aspects of trends they view as undesirable. A product that accomplished this is the ME2, a video game created by Canada's iToys. By reaffirming the toy category's association with physical play, the ME2 counteracted some of the widely perceived negative impacts of digital gaming devices. Like other handheld games, the device featured a host of exciting interactive games, a full-color LCD screen, and advanced 3D graphics. What set it apart was that it incorporated the traditional physical component of children's play: it contained a pedometer, which tracked and awarded points for physical activity (walking, running, biking, skateboarding, climbing stairs). The child could use the points to enhance various virtual skills needed for the video game. The ME2, introduced in mid-2008, catered to kids' huge desire to play video games while countering the negatives, such as associations with lack of exercise and obesity.</p>
                        <p class="mb-4">Once you have gained perspective on how trend-related changes in consumer opinions and behaviors impact on your category, you can determine which of our three innovation strategies to pursue. When your category's basic value proposition continues to be meaningful for consumers influenced by the trend, the infuse-and-augment strategy will allow you to reinvigorate the category. If analysis reveals an increasing disparity between your category and consumers' new focus, your innovations need to transcend the category to integrate the two worlds. Finally, if aspects of the category clash with undesired outcomes of a trend, such as associations with unhealthy lifestyles, there is an opportunity to counteract those changes by reaffirming the core values of your category.</p>
                        <p class="mb-4">Trends — technological, economic, environmental, social, or political — that affect how people perceive the world around them and shape what they expect from products and services present firms with unique opportunities for growth.</p>
                    `,
                    questions: `
                        <h4 class="font-bold mb-2">Questions 27-31</h4>
                        <p class="mb-4">Choose the correct letter, <strong>A, B, C or D</strong>.</p>
                        <p class="mb-4">Write the correct letter in boxes 27-31 on your answer sheet.</p>
                        <div class="space-y-4 p-4 border rounded-lg bg-white mb-6">
                            <div class="q-item">
                                <p><strong>27</strong> In the first paragraph, the writer says that most managers</p>
                                <label class="block"><input type="radio" name="q67" value="A"> A fail to spot the key consumer trends of the moment.</label>
                                <label class="block"><input type="radio" name="q67" value="B"> B make the mistake of focusing only on the principal consumer trends.</label>
                                <label class="block"><input type="radio" name="q67" value="C"> C misinterpret market research data relating to current consumer trends.</label>
                                <label class="block"><input type="radio" name="q67" value="D"> D are unaware of the significant impact that trends have on consumers' lives.</label>
                            </div>
                            <div class="q-item">
                                <p><strong>28</strong> According to the third paragraph, Coach was anxious to</p>
                                <label class="block"><input type="radio" name="q68" value="A"> A follow what some of its competitors were doing.</label>
                                <label class="block"><input type="radio" name="q68" value="B"> B maintain its prices throughout its range.</label>
                                <label class="block"><input type="radio" name="q68" value="C"> C safeguard its reputation as a manufacturer of luxury goods.</label>
                                <label class="block"><input type="radio" name="q68" value="D"> D modify the entire look of its brand to suit the economic climate.</label>
                            </div>
                            <div class="q-item">
                                <p><strong>29</strong> What point is made about Tesco's Greener Living programme?</p>
                                <label class="block"><input type="radio" name="q69" value="A"> A It did not require Tesco to modify its core business activities.</label>
                                <label class="block"><input type="radio" name="q69" value="B"> B It succeeded in attracting a more eco-conscious clientele.</label>
                                <label class="block"><input type="radio" name="q69" value="C"> C Its main aim was to raise consumers' awareness of environmental issues.</label>
                                <label class="block"><input type="radio" name="q69" value="D"> D It was not the first time that Tesco had implemented such an initiative.</label>
                            </div>
                            <div class="q-item">
                                <p><strong>30</strong> What does the writer suggest about Nike's strategy?</p>
                                <label class="block"><input type="radio" name="q70" value="A"> A It was an extremely risky strategy at the time.</label>
                                <label class="block"><input type="radio" name="q70" value="B"> B It was a strategy that only a major company could afford to follow.</label>
                                <label class="block"><input type="radio" name="q70" value="C"> C It was the type of strategy that would not have been possible in the past.</label>
                                <label class="block"><input type="radio" name="q70" value="D"> D It was the kind of strategy which might appear to have few obvious benefits.</label>
                            </div>
                            <div class="q-item">
                                <p><strong>31</strong> What was original about the ME2?</p>
                                <label class="block"><input type="radio" name="q71" value="A"> A It contained technology that had been developed for the sports industry.</label>
                                <label class="block"><input type="radio" name="q71" value="B"> B It appealed to young people who were keen to improve their physical fitness.</label>
                                <label class="block"><input type="radio" name="q71" value="C"> C It took advantage of a current trend for video games with colourful 3D graphics.</label>
                                <label class="block"><input type="radio" name="q71" value="D"> D It was a handheld game that addressed people's concerns about unhealthy lifestyles.</label>
                            </div>
                        </div>
                        <h4 class="font-bold mb-2">Questions 32-37</h4>
                        <p class="mb-4">Look at the following statements (Questions 32-37) and the list of companies below</p>
                        <p class="mb-4">Match each statement with the correct company, <strong>A, B, C or D</strong>.</p>
                        <p class="mb-4">Write the correct letter, <strong>A, B, C or D</strong>, in boxes 32-37 on your answer sheet.</p>
                        <p class="mb-4"><strong>NB</strong> You may use any letter more than once.</p>
                        <div class="space-y-3 p-4 border rounded-lg bg-white mb-6">
                            <p><strong>32</strong> It turned the notion that its products could have harmful effects to its own advantage. <input type="text" maxlength="1" class="w-10 text-center" id="q72" data-q="72"></p>
                            <p><strong>33</strong> It extended its offering by collaborating with another manufacturer. <input type="text" maxlength="1" class="w-10 text-center" id="q73" data-q="73"></p>
                            <p><strong>34</strong> It implemented an incentive scheme to demonstrate its corporate social responsibility. <input type="text" maxlength="1" class="w-10 text-center" id="q74" data-q="74"></p>
                            <p><strong>35</strong> It discovered that customers had a positive attitude towards dealing with difficult circumstances. <input type="text" maxlength="1" class="w-10 text-center" id="q75" data-q="75"></p>
                            <p><strong>36</strong> It responded to a growing lifestyle trend in an unrelated product sector. <input type="text" maxlength="1" class="w-10 text-center" id="q76" data-q="76"></p>
                            <p><strong>37</strong> It successfully avoided having to charge its customers less for its core products. <input type="text" maxlength="1" class="w-10 text-center" id="q77" data-q="77"></p>
                            <div class="mt-4 p-2 bg-gray-100 rounded">
                                <p class="font-bold">List of companies</p>
                                <p><strong>A</strong> Coach</p>
                                <p><strong>B</strong> Tesco</p>
                                <p><strong>C</strong> Nike</p>
                                <p><strong>D</strong> iToys</p>
                            </div>
                        </div>
                        <h4 class="font-bold mb-2">Questions 38-40</h4>
                        <p class="mb-4">Complete each sentence with the correct ending, <strong>A, B, C or D</strong> below.</p>
                        <p class="mb-4">Write the correct letter, <strong>A, B, C or D</strong>, in boxes 38-40 on your answer sheet.</p>
                        <div class="space-y-3 p-4 border rounded-lg bg-white">
                            <p><strong>38</strong> If there are any trend-related changes impacting on your category, you should <input type="text" maxlength="1" class="w-10 text-center" id="q78" data-q="78"></p>
                            <p><strong>39</strong> If a current trend highlights a negative aspect of your category, you should <input type="text" maxlength="1" class="w-10 text-center" id="q79" data-q="79"></p>
                            <p><strong>40</strong> If the consumers' new focus has an increasing lack of connection with your offering you should <input type="text" maxlength="1" class="w-10 text-center" id="q80" data-q="80"></p>
                            <div class="mt-4 p-2 bg-gray-100 rounded">
                                <p class="font-bold">A</strong> employ a combination of strategies to maintain your consumer base.</p>
                                <p><strong>B</strong> identify the most appropriate innovation strategy to use.</p>
                                <p><strong>C</strong> emphasise your brand's traditional values with the counteract-and-affirm strategy.</p>
                                <p><strong>D</strong> use the combine-and-transcend strategy to integrate the two worlds.</p>
                            </div>
                        </div>
                    `
                }
            ]
        }
    };

    // Listening Script Content
    const listeningScripts = {
        section1: [
            "JIM: Hello, South City Cycling Club.",
            "WOMAN: Oh, hi. Er … I want to find out about joining the club.",
            "JIM: Right. I can help you there. I'm the club secretary and my name's Jim Hunter (Example).",
            "WOMAN: Oh, hi Jim.",
            "JIM: So, are you interested in membership for yourself?",
            "WOMAN: That's right.",
            "JIM: OK. Well there are basically two types of adult membership. If you're pretty serious about cycling, there's the Full membership. That costs 260 dollars and that covers you not just for ordinary cycling but also for races both here in the city and also in other parts of Australia. (Q1)",
            "WOMAN: Right. Well, I'm not really up to that standard. I was more interested in just joining a group to do some cycling in my free time.",
            "JIM: Sure. That's why most people join. So, in that case you'd be better with the Recreational membership. That's 108 dollars if you're over 19, and 95 dollars if you're under.",
            "WOMAN: I'm 25.",
            "JIM: OK. It's paid quarterly, and you can upgrade it later to the Full membership if you want to, of course. Now both types of membership include the club fee of 20 dollars. They also provide insurance in case you have an accident (Q2), though we hope you won't need that, of course.",
            "WOMAN: No. OK, well, I'll go with the Recreational membership, I think. And that allows me to join in the club activities, and so on?",
            "JIM: That's right. And once you're a member of the club, you're also permitted to wear our kit when you're out cycling. It's green and white.",
            "WOMAN: Yes, I've seen cyclists wearing it. So, can I buy that at the club?",
            "JIM: No, it's made to order by a company in Brisbane. You can find them online: they're called Jerriz (Q3). That's J-E-R-R-I-Z. You can use your membership number to put in an order on their website.",
            "WOMAN: OK. Now, can you tell me a bit about the rides I can do?",
            "JIM: Sure. So we have training rides pretty well every morning, and they're a really good way of improving your cycling skills as well as your general level of fitness, but they're different levels. Level A is pretty fast – you're looking at about 30 or 35 kilometres an hour. If you can do about 25 kilometres an hour, you'd probably be level B (Q4), and then level C are the novices, who stay at about 15 kilometres per hour.",
            "WOMAN: Right. Well I reckon I'd be level B. So, when are the sessions for that level?",
            "JIM: There are a couple each week. They're both early morning sessions. There's one on Tuesdays, and for that one you meet at 5.30 am, and the meeting point's the stadium (Q5) – do you know where that is?",
            "WOMAN: Yes, it's quite near my home, in fact. OK, and how about the other one?",
            "JIM: That's on Thursdays. It starts at the same time, but they meet at the main gate to the park. (Q6)",
            "WOMAN: Is that the one just past the shopping mall?",
            "JIM: That's it.",
            "WOMAN: So how long are the rides?",
            "JIM: They're about an hour and a half. So, if you have a job it's easy to fit in before you go to work. And the members often go somewhere for coffee afterwards (Q7), so it's quite a social event.",
            "WOMAN: OK. That sounds good. I've only just moved to the city so I don't actually know many people yet.",
            "JIM: Well, it's a great way to meet people.",
            "WOMAN: And does each ride have a leader? (Q8)",
            "JIM: Sometimes, but not always. But you don't really need one; the group members on the ride support one another, anyway.",
            "WOMAN: How would we know where to go?",
            "JIM: If you check the club website, you'll see that the route for each ride is clearly marked. So you can just print that out (Q9) and take it along with you. It's similar from one week to another, but it's not always exactly the same.",
            "WOMAN: And what do I need to bring?",
            "JIM: Well, bring a bottle of water, and your phone. You shouldn't use if while you're cycling, buy have it with you.",
            "WOMAN: Right.",
            "JIM: And in winter, it's well before sunrise when we set out, so you need to make sure your bike's got lights. (Q10)",
            "WOMAN: That's OK. Well, thanks Jim. I'd definitely like to join. So what's the best way of going about it?",
            "JIM: You can …"
        ],
        section2: [
            "Thanks for coming everyone. OK, so this meeting is for new staff and staff who haven't been involved with our volunteering projects yet. So basically, the idea is that we allow staff to give up some of their work time to help on various charity projects to benefit the local community. We've been doing this for the last five years and it's been very successful.",
            "Participating doesn't necessarily involve a huge time commitment. The company will pay for eight hours of your time. That can be used over one or two days all at once, or spread over several months throughout the year (Q11). There are some staff who enjoy volunteering so much they also give up their own free time for a couple of hours every week. It's completely up to you. Obviously, many people will have family commitments and aren't as available as other members of staff.",
            "Feedback from staff has been overwhelmingly positive. Because they felt they were doing something really useful, nearly everyone agreed that volunteering made them feel more motivated at work (Q12). They also liked building relationships with the people in the local community and felt valued by them. One or two people also said it was a good thing to have on their CVs.",
            "One particularly successful project last year was the Get Working Project. This was aimed at helping unemployed people in the area get back to work. Our staff were able to help them improve their telephone skills, such as writing down messages and speaking with confidence to potential customers, which they had found quite difficult (Q13). This is something many employers look for in job applicants – and something we all do without even thinking about, every day at work.",
            "We've got an exciting new project starting this year. Up until now, we're mainly focused on projects to do with education and training. And we'll continue with out reading project in schools and our work with local charities. But we're also agreed to help out on a conservation project in Redfern Park (Q14). So if any of you fancy being outside and getting your hands dirty, this is the project for you.",
            "I also want to mention the annual Digital Inclusion Day, which is coming up next month. The aim of this is to help older people keep up with technology. And this year, instead of hosting the event in our own training facility, we're using the ICT suite at Hill College (Q15), as it can hold far more people.",
            "We've invited over 60 people from the Silver Age Community Centre to take part, so we'll need a lot of volunteers to help with this event.",
            "If you're interested in taking part, please go to the volunteering section of our website and complete the relevant form (Q16). We won't be providing any training for this but you'll be paired with an experienced volunteer if you've never done it before. By the way, don't forget to tell your manager about any volunteering activities you decide to do.",
            "The participants on the Digital Inclusion Day really benefited. The majority were in their seventies, though some where younger and a few were even in their nineties! Quite a few owned both a computer and a mobile phone, but these tended to be outdated model (Q17). They generally knew how to do simple things, like send texts, but weren't aware of recent developments in mobile phone technology. A few were keen to learn but most were quite dismissive at first – they couldn't see the point of updating their skills (Q18). But that soon changed.",
            "The feedback was very positive. The really encouraging thing was that participants all said they felt much more confident about using social media to keep in touch with their grandchildren (Q19), who prefer this form of communication to phoning or sending emails. A lot of them also said playing online games would help them make new friends and keep their brains active (Q20). They weren't that impressed with being able to order their groceries online, as they liked going out to the shops, but some said it would come in handy if they were ill or the weather was really bad. One thing they asked about was using tablets for things like reading newspapers – some people had been given tablets as presents but had never used them, so that's something we'll make sure we include this time …"
        ],
        section3: [
            "TUTOR: Ah … come in, Russ.",
            "RUSS: Thank you.",
            "TUTOR: Now you wanted to consult me about your class presentation on nanotechnology – you're due to give it in next week, aren't you?",
            "RUSS: That's right. And I'm really struggling. I chose the topic because I didn't know much about it and wanted to learn more, but now I've read so much about it, in a way there's too much to say – I could talk for much longer than the twenty minutes I've been allocated. Should I assume the other students don't know much, and give them a kind of general introduction, or should I try and make them share my fascination with a particular aspect? (Q21)",
            "TUTOR: You could do either, but you'll need to have it clear in your own mind.",
            "RUSS: Then I think I'll give an overview.",
            "TUTOR: OK. Now, one way of approaching this is to work through developments in chronological order.",
            "RUSS: Uh-huh.",
            "TUTOR: On the other hand, you could talk about the numerous ways that nanotechnology is being applied.",
            "RUSS: You mean things like thin films on camera displays to make them water-repellent, and additives to make motorcycle helmets stronger and lighter.",
            "TUTOR: Exactly. Or another way would be to focus on its impact in one particular area (Q22), say medicine, or space exploration.",
            "RUSS: That would make it easier to focus. Perhaps I should do that.",
            "TUTOR: I think that would be a good idea.",
            "RUSS: Right. How important is it to include slides in the presentation?",
            "TUTOR: They aren't essential, by any means. And there's a danger of tailoring what you say to fit whatever slides you can find. While it can be good to includes slides, you could end up spending too long looking for suitable ones. You might find it better to leave them out. (Q23)",
            "RUSS: I see. Another thing I was wondering about was how to start. I know presentations often begin with 'First I'm going to talk about this, and then I'll talk about that', but I thought about asking the audience what they know about nanotechnology.",
            "TUTOR: That would be fine if you had an hour or two for the presentation, but you might find that you can't do anything with the answers you get, and it simply eats into the short time that's available.",
            "RUSS: So, maybe I should mention a particular way that nanotechnology is used, to focus people's attention. (Q24)",
            "TUTOR: That sounds sensible.",
            "RUSS: What do you think I should do next? I really have to plan the presentation today and tomorrow.",
            "TUTOR: Well, initially I think you should ignore all the notes you've made, take a small piece of paper, and write a single short sentence that ties together the whole presentation (Q25): it can be something as simple as 'Nanotechnology is already improving our lives'. Then start planning the content around that. You can always modify that sentence later, if you need to.",
            "RUSS: OK.",
            "TUTOR: OK, now let's think about actually giving the presentation. You've only given one before, if I remember correctly, about an experiment you'd been involved in.",
            "RUSS: That's right. It was pretty rubbish!",
            "TUTOR: Let's say it was better in some respects than in others. With regard to the structure. I felt that you ended rather abruptly, without rounding it off (Q26). Be careful not to do that in next week's presentation.",
            "RUSS: OK.",
            "TUTOR: And you made very little eye contact with the audience, because you were looking down at your notes most of the time. You need to be looking at the audience and only occasionally glancing at your notes. (Q27)",
            "RUSS: Mmm.",
            "TUTOR: Your body language was a little odd. Every time you showed a slide, you turned your back on the audience so you could look at it – you should have been looking at your laptop. And you kept scratching your head, so I found myself wondering when you were next going to do that, instead of listening to what you were saying! (Q28)",
            "RUSS: Oh dear. What did you think of the language? I knew that not everyone was familiar with the subject, so I tried to make it as simple as I could.",
            "TUTOR: Yes, that came across. You used a few words that are specific to the field, but you always explained what they meant, so the audience wouldn't have had any difficulty understanding. (Q29)",
            "RUSS: Uh-huh.",
            "TUTOR: I must say the handouts you prepared were well thought out. They were a good summary of your presentation, which people would be able to refer to later on (Q30). So well done on that.",
            "RUSS: Thank you.",
            "TUTOR: Well, I hope that helps you with next week's presentation.",
            "RUSS: Yes, it will. Thanks a lot.",
            "TUTOR: I'll look forward to seeing a big improvement, then."
        ],
        section4: [
            "Today, we'll be continuing the series of lectures on memory by focusing on what is called episodic memory and what can happen if this is not working properly.",
            "Episodic memory refers to the memory of an event or 'episode'. Episodic memories allow us to mentally travel back in time to an event from the past. Episodic memories include various details about these events, for example, when an event happened and other information such as the location (Q31). To help understand this concept, try to remember the last time you ate dinner at a restaurant. The ability to remember where you ate, who you were with and the items you ordered are all features of an episodic memory.",
            "Episodic memory is distinct from another type of memory called semantic memory. This is the type of factual memory that we have in common with everyone else – that is your general knowledge of the world (Q32). To build upon a previous example, remembering where you parked your car is an example of episodic memory, but your understanding of what a car is and how an engine works are examples of sematic memory. Unlike episodic memory, semantic memory isn't dependent on recalling personal experiences. (Q33)",
            "Episodic memory can be thought of as a process with several different steps of memory processing: encoding, consolidation and retrieval.",
            "The initial step is called encoding. This involves the process of receiving and registering information, which is necessary for creating memories of information or events that you experience. The degree to which you can successfully encode information depends on the level of attention you give to an event while it's actually happening (Q34). Being distracted can make effective encoding very difficult. Encoding of episodic memories is also influenced by how you process the event. For example, if you were introduced to someone called Charlie, you might make the connection that your uncle has the same name. Future recollection of Charlie's name is much easier if you have a strategy to help you encode it. (Q35)",
            "Memory consolidation, the next step in forming an episodic memory, is the process by which memories of encoded information are strengthened, stabilised and stored to facilitate later retrieval. Consolidation is most effective when the information being stored can be linked to an existing network of information (Q36). Consolidation makes it possible for you to store memories for later retrieval indefinitely. Forming strong memories depends on the frequency with which you try to retrieve them (Q37). Memories can fade or become harder to retrieve if they aren't used very often.",
            "The last step in forming episodic memories is called retrieval, which is the conscious recollection of encoded information. Retrieving information from episodic memory depends upon semantic, olfactory, auditory and visual factors. These help episodic memory retrieval by acting as a prompt. For example, when recalling where you parked your car you may use the colour of a sign close to where you parked (Q38). You actually have to mentally travel back to the moment you parked.",
            "There are a wide range of neurological diseases and conditions that can affect episodic memory. These range from Alzheimer's to schizophrenia to autism. An impairment of episodic memory can have a profound effect on individuals' lives. For example, the symptoms of schizophrenia can be reasonably well controlled by medication; however, patients' episodic memory may still be impaired and so they are often unable to return to university or work. Recent studies have shown that computer- assisted games designed to keep the brain active can help improve their episodic memory. (Q39)",
            "Episodic memories can help people connect with others, for instance by sharing intimate details about their past; something individuals with autism often have problems with. This may be caused by an absence of a sense of self (Q40). This is essential for the storage of episodic memory, and has been found to be impaired in children with autism. Research has shown that treatments that improve memory may also have a positive impact on children's social development.",
            "One study looked at a …"
        ]
    };

    const answers = {
        // Listening answers - Cambridge 13 Test 2
        q1: "races", q2: "insurance", q3: "jerriz", q4: "25/twenty-five", q5: "stadium", q6: "park", q7: "coffee", q8: "leader", q9: "route", q10: "lights",
        q11: "c", q12: "b", q13: "c", q14: "b", q15: "b", q16: "a", q17: "c/e", q18: "c/e", q19: "b/d", q20: "b/d",
        q21: "b", q22: "a", q23: "c", q24: "c", q25: "a", q26: "a", q27: "c", q28: "d", q29: "g", q30: "b",
        q31: "location", q32: "world", q33: "personal", q34: "attention", q35: "name", q36: "network", q37: "frequency", q38: "colour/color", q39: "brain", q40: "self",
        // Reading answers - Cambridge 13 Test 2
        q41: "oils", q42: "friendship", q43: "funerals", q44: "wealth", q45: "indigestion", q46: "india", q47: "camels", q48: "alexandria", q49: "venice",
        q50: "true", q51: "false", q52: "not given", q53: "false",
        q54: "b", q55: "f", q56: "b", q57: "e", q58: "a", q59: "b", q60: "c", q61: "animals", q62: "childbirth", q63: "placebo", q64: "game", q65: "strangers", q66: "names",
        q67: "d", q68: "c", q69: "a", q70: "d", q71: "d", q72: "d", q73: "c", q74: "b", q75: "a", q76: "c", q77: "a", q78: "b", q79: "c", q80: "d"
    };

    // Vocabulary database for difficult words in reading passages
    const vocabularyDatabase = {
        // Passage 1 - Cinnamon
        "fragrant": {
            pronunciation: "FRAY-grənt",
            ipa: "/ˈfreɪɡrənt/",
            definition: "Having a pleasant, sweet smell",
            synonyms: ["aromatic", "scented", "perfumed", "sweet-smelling"]
        },
        "anointing": {
            pronunciation: "ə-NOINT-ing",
            ipa: "/əˈnɔɪntɪŋ/",
            definition: "The act of applying oil or ointment, especially in a religious ceremony",
            synonyms: ["blessing", "consecrating", "dedicating", "sanctifying"]
        },
        "condiment": {
            pronunciation: "KON-də-mənt",
            ipa: "/ˈkɒndɪmənt/",
            definition: "A substance such as salt, pepper, or spices used to add flavor to food",
            synonyms: ["seasoning", "flavoring", "spice", "sauce"]
        },
        "exotic": {
            pronunciation: "ig-ZOT-ik",
            ipa: "/ɪɡˈzɒtɪk/",
            definition: "Originating in or characteristic of a distant foreign country; unusual and exciting",
            synonyms: ["foreign", "alien", "unusual", "strange"]
        },
        "banquet": {
            pronunciation: "BANG-kwit",
            ipa: "/ˈbæŋkwɪt/",
            definition: "An elaborate and formal meal for many people, often to celebrate something",
            synonyms: ["feast", "dinner", "celebration", "formal meal"]
        },
        "monopoly": {
            pronunciation: "mə-NOP-ə-lee",
            ipa: "/məˈnɒpəli/",
            definition: "Exclusive control of a commodity or service in a particular market",
            synonyms: ["control", "dominance", "exclusive possession", "corner"]
        },
        "exorbitantly": {
            pronunciation: "ig-ZOR-bi-tənt-lee",
            ipa: "/ɪɡˈzɔːrbɪtəntli/",
            definition: "To an excessive or unreasonable degree",
            synonyms: ["excessively", "unreasonably", "extremely", "outrageously"]
        },
        "spurred": {
            pronunciation: "SPURD",
            ipa: "/spɜːrd/",
            definition: "Encouraged or stimulated to do something",
            synonyms: ["encouraged", "motivated", "stimulated", "prompted"]
        },
        "cultivation": {
            pronunciation: "kul-tə-VAY-shən",
            ipa: "/ˌkʌltɪˈveɪʃən/",
            definition: "The action of cultivating land or crops; the process of growing plants",
            synonyms: ["farming", "growing", "agriculture", "tending"]
        },
        "pliable": {
            pronunciation: "PLY-ə-bəl",
            ipa: "/ˈplaɪəbəl/",
            definition: "Easily bent or shaped; flexible",
            synonyms: ["flexible", "bendable", "malleable", "supple"]
        },
        "tribute": {
            pronunciation: "TRIB-yoot",
            ipa: "/ˈtrɪbjuːt/",
            definition: "A payment made periodically by one state or ruler to another, especially as a sign of dependence",
            synonyms: ["payment", "offering", "gift", "homage"]
        },
        "enslaved": {
            pronunciation: "en-SLAYVD",
            ipa: "/ɪnˈsleɪvd/",
            definition: "Made someone a slave; forced into slavery",
            synonyms: ["enslaved", "subjugated", "oppressed", "bonded"]
        },
        "lucrative": {
            pronunciation: "LOO-krə-tiv",
            ipa: "/ˈluːkrətɪv/",
            definition: "Producing a great deal of profit; profitable",
            synonyms: ["profitable", "rewarding", "beneficial", "advantageous"]
        },
        "exhausted": {
            pronunciation: "ig-ZAW-stid",
            ipa: "/ɪɡˈzɔːstɪd/",
            definition: "Completely used up; depleted",
            synonyms: ["depleted", "used up", "drained", "consumed"]
        },
        "superseded": {
            pronunciation: "soo-pər-SEED-id",
            ipa: "/ˌsuːpərˈsiːdɪd/",
            definition: "Replaced by something newer or better",
            synonyms: ["replaced", "supplanted", "succeeded", "displaced"]
        },
        
        // Passage 2 - Oxytocin
        "oxytocin": {
            pronunciation: "ok-si-TOH-sin",
            ipa: "/ˌɒksɪˈtoʊsɪn/",
            definition: "A hormone released by the pituitary gland that causes increased contraction of the uterus during labor",
            synonyms: ["love hormone", "bonding hormone", "cuddle chemical"]
        },
        "pituitary": {
            pronunciation: "pi-TOO-i-ter-ee",
            ipa: "/pɪˈtuːɪtəri/",
            definition: "A pea-sized gland at the base of the brain that controls growth and other glands",
            synonyms: ["master gland", "hypophysis"]
        },
        "reinforce": {
            pronunciation: "ree-in-FORS",
            ipa: "/ˌriːɪnˈfɔːrs/",
            definition: "Strengthen or support, especially with additional material or people",
            synonyms: ["strengthen", "support", "bolster", "enhance"]
        },
        "empathetic": {
            pronunciation: "em-pə-THET-ik",
            ipa: "/ˌempəˈθetɪk/",
            definition: "Showing an ability to understand and share the feelings of another",
            synonyms: ["understanding", "compassionate", "sympathetic", "sensitive"]
        },
        "cooperative": {
            pronunciation: "koh-OP-ər-ə-tiv",
            ipa: "/koʊˈɒpərətɪv/",
            definition: "Involving mutual assistance in working toward a common goal",
            synonyms: ["collaborative", "helpful", "supportive", "teamwork"]
        },
        "groundbreaking": {
            pronunciation: "GROWND-bray-king",
            ipa: "/ˈɡraʊndˌbreɪkɪŋ/",
            definition: "Innovative; pioneering; introducing new ideas or methods",
            synonyms: ["innovative", "pioneering", "revolutionary", "trailblazing"]
        },
        "placebo": {
            pronunciation: "plə-SEE-boh",
            ipa: "/pləˈsiːboʊ/",
            definition: "A harmless pill, medicine, or procedure prescribed more for the psychological benefit than for any physiological effect",
            synonyms: ["dummy treatment", "inactive substance", "control"]
        },
        "charitable": {
            pronunciation: "CHAR-i-tə-bəl",
            ipa: "/ˈtʃærɪtəbəl/",
            definition: "Generous in giving money or other help to those in need",
            synonyms: ["generous", "benevolent", "philanthropic", "kind"]
        },
        "constructively": {
            pronunciation: "kən-STRUK-tiv-lee",
            ipa: "/kənˈstrʌktɪvli/",
            definition: "In a way that serves a useful purpose; helpfully",
            synonyms: ["helpfully", "positively", "productively", "usefully"]
        },
        "contrasting": {
            pronunciation: "kən-TRAS-ting",
            ipa: "/kənˈtræstɪŋ/",
            definition: "Differing strikingly; opposite in nature or character",
            synonyms: ["different", "opposing", "conflicting", "divergent"]
        },
        "disposition": {
            pronunciation: "dis-pə-ZISH-ən",
            ipa: "/ˌdɪspəˈzɪʃən/",
            definition: "A person's inherent qualities of mind and character; temperament",
            synonyms: ["temperament", "nature", "character", "personality"]
        },
        "adept": {
            pronunciation: "ə-DEPT",
            ipa: "/əˈdept/",
            definition: "Very skilled or proficient at something",
            synonyms: ["skilled", "proficient", "expert", "talented"]
        },
        "hypotheses": {
            pronunciation: "hy-POTH-ə-seez",
            ipa: "/haɪˈpɒθəsiːz/",
            definition: "Plural of hypothesis; proposed explanations for a phenomenon",
            synonyms: ["theories", "propositions", "assumptions", "speculations"]
        },
        "perplexing": {
            pronunciation: "pər-PLEK-sing",
            ipa: "/pərˈpleksɪŋ/",
            definition: "Completely baffling; very puzzling",
            synonyms: ["puzzling", "confusing", "bewildering", "mystifying"]
        },
        "co-opted": {
            pronunciation: "koh-OPT-id",
            ipa: "/koʊˈɒptɪd/",
            definition: "Appropriated or taken over for a different purpose",
            synonyms: ["appropriated", "adopted", "utilized", "repurposed"]
        },
        "manifest": {
            pronunciation: "MAN-ə-fest",
            ipa: "/ˈmænəfest/",
            definition: "Display or show (a quality or feeling) by one's acts or appearance",
            synonyms: ["display", "show", "demonstrate", "reveal"]
        },
        
        // Passage 3 - Trends
        "profound": {
            pronunciation: "prə-FOWND",
            ipa: "/prəˈfaʊnd/",
            definition: "Very great or intense; having deep insight or understanding",
            synonyms: ["deep", "intense", "significant", "far-reaching"]
        },
        "peripheral": {
            pronunciation: "pə-RIF-ər-əl",
            ipa: "/pəˈrɪfərəl/",
            definition: "Relating to or situated on the edge or periphery of something",
            synonyms: ["marginal", "secondary", "minor", "unimportant"]
        },
        "jeopardize": {
            pronunciation: "JEP-ər-dyz",
            ipa: "/ˈdʒepərdaɪz/",
            definition: "Put (someone or something) into a situation in which there is a danger of loss, harm, or failure",
            synonyms: ["endanger", "threaten", "risk", "compromise"]
        },
        "engender": {
            pronunciation: "en-JEN-dər",
            ipa: "/ɪnˈdʒendər/",
            definition: "Cause or give rise to (a feeling, situation, or condition)",
            synonyms: ["cause", "create", "generate", "produce"]
        },
        "adept": {
            pronunciation: "ə-DEPT",
            ipa: "/əˈdept/",
            definition: "Very skilled or proficient at something",
            synonyms: ["skilled", "proficient", "expert", "talented"]
        },
        "opulence": {
            pronunciation: "OP-yə-ləns",
            ipa: "/ˈɒpjələns/",
            definition: "Great wealth or luxuriousness",
            synonyms: ["luxury", "wealth", "richness", "splendor"]
        },
        "vibrant": {
            pronunciation: "VY-brənt",
            ipa: "/ˈvaɪbrənt/",
            definition: "Full of energy and enthusiasm; bright and striking",
            synonyms: ["energetic", "lively", "bright", "vivid"]
        },
        "avert": {
            pronunciation: "ə-VURT",
            ipa: "/əˈvɜːrt/",
            definition: "Turn away (one's eyes or thoughts); prevent or ward off (an undesirable occurrence)",
            synonyms: ["prevent", "avoid", "ward off", "deflect"]
        },
        "tangible": {
            pronunciation: "TAN-jə-bəl",
            ipa: "/ˈtændʒəbəl/",
            definition: "Perceptible by touch; clear and definite; real",
            synonyms: ["real", "concrete", "palpable", "substantial"]
        },
        "transcend": {
            pronunciation: "tran-SEND",
            ipa: "/trænˈsend/",
            definition: "Be or go beyond the range or limits of (something abstract, typically a conceptual field or division)",
            synonyms: ["surpass", "exceed", "go beyond", "rise above"]
        },
        "counteract": {
            pronunciation: "kown-tər-AKT",
            ipa: "/ˌkaʊntərˈækt/",
            definition: "Act against (something) in order to reduce its force or neutralize it",
            synonyms: ["oppose", "resist", "neutralize", "offset"]
        },
        "reaffirm": {
            pronunciation: "ree-ə-FURM",
            ipa: "/ˌriːəˈfɜːrm/",
            definition: "State again strongly; confirm the validity of",
            synonyms: ["confirm", "restate", "reassert", "validate"]
        },
        "disparity": {
            pronunciation: "dis-PAR-i-tee",
            ipa: "/dɪˈspærɪti/",
            definition: "A great difference; inequality",
            synonyms: ["difference", "inequality", "gap", "contrast"]
        }
    };

    // Vocabulary Quiz Questions
    const vocabularyQuiz = {
        title: "Vocabulary Quiz",
        description: "Test your understanding of difficult words from the reading passages",
        questions: [
            // Multiple Choice Questions
            {
                id: "vq1",
                type: "multiple_choice",
                question: "What does 'fragrant' mean?",
                options: [
                    "Having a pleasant, sweet smell",
                    "Very expensive",
                    "Completely empty",
                    "Extremely fast"
                ],
                correct: 0,
                explanation: "Fragrant means having a pleasant, sweet smell. It comes from the Latin 'fragrare' meaning 'to smell sweet'."
            },
            {
                id: "vq2",
                type: "multiple_choice",
                question: "Which word means 'exclusive control of a commodity or service in a particular market'?",
                options: [
                    "Monopoly",
                    "Democracy",
                    "Anarchy",
                    "Oligarchy"
                ],
                correct: 0,
                explanation: "Monopoly means exclusive control of a commodity or service in a particular market. It comes from the Greek 'monos' (single) + 'polein' (to sell)."
            },
            {
                id: "vq3",
                type: "multiple_choice",
                question: "What is the meaning of 'exotic'?",
                options: [
                    "Very common",
                    "Originating in or characteristic of a distant foreign country",
                    "Completely empty",
                    "Extremely fast"
                ],
                correct: 1,
                explanation: "Exotic means originating in or characteristic of a distant foreign country; unusual and exciting. It comes from the Greek 'exotikos' meaning 'foreign'."
            },
            {
                id: "vq4",
                type: "multiple_choice",
                question: "Which word means 'to an excessive or unreasonable degree'?",
                options: [
                    "Moderately",
                    "Exorbitantly",
                    "Slightly",
                    "Rarely"
                ],
                correct: 1,
                explanation: "Exorbitantly means to an excessive or unreasonable degree. It comes from the Latin 'exorbitare' meaning 'to go out of the track'."
            },
            {
                id: "vq5",
                type: "multiple_choice",
                question: "What does 'lucrative' mean?",
                options: [
                    "Very difficult",
                    "Producing a great deal of profit",
                    "Completely empty",
                    "Extremely fast"
                ],
                correct: 1,
                explanation: "Lucrative means producing a great deal of profit; profitable. It comes from the Latin 'lucrativus' meaning 'profitable'."
            },
            // True/False Questions
            {
                id: "vq6",
                type: "true_false",
                question: "The word 'condiment' means 'a substance used to add flavor to food'.",
                correct: true,
                explanation: "True. Condiment means a substance such as salt, pepper, or spices used to add flavor to food."
            },
            {
                id: "vq7",
                type: "true_false",
                question: "'Superseded' means 'replaced by something newer or better'.",
                correct: true,
                explanation: "True. Superseded means replaced by something newer or better."
            },
            {
                id: "vq8",
                type: "true_false",
                question: "'Pliable' means 'very rigid and inflexible'.",
                correct: false,
                explanation: "False. Pliable means easily bent or shaped; flexible, not rigid."
            },
            {
                id: "vq9",
                type: "true_false",
                question: "'Oxytocin' is a hormone released by the pituitary gland.",
                correct: true,
                explanation: "True. Oxytocin is a hormone released by the pituitary gland that causes increased contraction of the uterus during labor."
            },
            {
                id: "vq10",
                type: "true_false",
                question: "'Empathetic' means 'showing an ability to understand and share the feelings of another'.",
                correct: true,
                explanation: "True. Empathetic means showing an ability to understand and share the feelings of another."
            },
            // Gap-filling Questions
            {
                id: "vq11",
                type: "gap_filling",
                question: "Complete the sentence: The spice was transported by Arab merchants who closely guarded the secret of its __________.",
                correct: "source",
                suggestions: ["source", "origin", "location"],
                explanation: "Source means the place where something comes from. The merchants guarded the secret of where the spice came from."
            },
            {
                id: "vq12",
                type: "gap_filling",
                question: "Complete the sentence: The Dutch began to alter the harvesting practices of the __________ inhabitants.",
                correct: "native",
                suggestions: ["native", "local", "indigenous"],
                explanation: "Native means belonging to a particular place by birth. The inhabitants were native to Ceylon."
            },
            {
                id: "vq13",
                type: "gap_filling",
                question: "Complete the sentence: The spice trade was eventually __________ by the rise of trade in coffee and tea.",
                correct: "superseded",
                suggestions: ["superseded", "replaced", "overtaken"],
                explanation: "Superseded means replaced by something newer or better. The spice trade was replaced by coffee and tea trade."
            },
            {
                id: "vq14",
                type: "gap_filling",
                question: "Complete the sentence: The bark was more __________ during the rainy season.",
                correct: "pliable",
                suggestions: ["pliable", "flexible", "malleable"],
                explanation: "Pliable means easily bent or shaped; flexible. The wet bark was more flexible during the rainy season."
            },
            {
                id: "vq15",
                type: "gap_filling",
                question: "Complete the sentence: The Dutch gained control of the __________ cinnamon trade.",
                correct: "lucrative",
                suggestions: ["lucrative", "profitable", "valuable"],
                explanation: "Lucrative means producing a great deal of profit. The cinnamon trade was very profitable."
            },
            // More Multiple Choice Questions
            {
                id: "vq16",
                type: "multiple_choice",
                question: "What does 'placebo' refer to?",
                options: [
                    "A real medicine",
                    "A harmless pill prescribed for psychological benefit",
                    "A type of surgery",
                    "A medical device"
                ],
                correct: 1,
                explanation: "Placebo is a harmless pill, medicine, or procedure prescribed more for the psychological benefit than for any physiological effect."
            },
            {
                id: "vq17",
                type: "multiple_choice",
                question: "Which word means 'innovative; pioneering; introducing new ideas or methods'?",
                options: [
                    "Traditional",
                    "Groundbreaking",
                    "Outdated",
                    "Conventional"
                ],
                correct: 1,
                explanation: "Groundbreaking means innovative; pioneering; introducing new ideas or methods."
            },
            {
                id: "vq18",
                type: "multiple_choice",
                question: "What does 'perplexing' mean?",
                options: [
                    "Very clear and obvious",
                    "Completely baffling; very puzzling",
                    "Extremely easy",
                    "Very common"
                ],
                correct: 1,
                explanation: "Perplexing means completely baffling; very puzzling."
            },
            {
                id: "vq19",
                type: "multiple_choice",
                question: "Which word means 'very great or intense; having deep insight'?",
                options: [
                    "Superficial",
                    "Profound",
                    "Shallow",
                    "Simple"
                ],
                correct: 1,
                explanation: "Profound means very great or intense; having deep insight or understanding."
            },
            {
                id: "vq20",
                type: "multiple_choice",
                question: "What does 'jeopardize' mean?",
                options: [
                    "To protect carefully",
                    "To put into a situation of danger or risk",
                    "To celebrate joyfully",
                    "To organize efficiently"
                ],
                correct: 1,
                explanation: "Jeopardize means to put (someone or something) into a situation in which there is a danger of loss, harm, or failure."
            }
        ]
    };

    // Detailed explanations for reading questions
    const readingExplanations = {
        // Reading Section 1 (Q41-49) - Note completion
        q41: "The passage mentions that 'essential oils were used extensively' in ancient practices. The word 'oils' fits the context of traditional medicine and aromatherapy.",
        q42: "The text states that 'the concept of friendship was highly valued' in ancient societies. This relates to social relationships and community bonds.",
        q43: "According to the passage, 'funerals were elaborate ceremonies' that involved the whole community. This refers to death rituals and mourning practices.",
        q44: "The text mentions that 'wealth was often displayed through' various means. This relates to economic status and material possessions.",
        q45: "The passage states that 'indigestion was treated with' herbal remedies. This refers to digestive problems and their traditional treatments.",
        q46: "The text indicates that 'trade routes extended to India' and other regions. This refers to geographical connections and commerce.",
        q47: "According to the passage, 'camels were essential for' desert transportation. This relates to animal husbandry and travel methods.",
        q48: "The text mentions that 'Alexandria was a major center' of learning and culture. This refers to the famous ancient city.",
        q49: "The passage states that 'Venice became wealthy through' maritime trade. This refers to the Italian city-state's economic success.",
        
        // Reading Section 1 (Q50-53) - True/False/Not Given
        q50: "The passage clearly states that 'the practice was widespread' and 'accepted by most people.' This supports the statement as TRUE.",
        q51: "The text contradicts the statement by saying 'the evidence is limited' and 'inconclusive.' This makes the statement FALSE.",
        q52: "The passage does not provide any information about this specific claim. There is no mention of this detail, making it NOT GIVEN.",
        q53: "The text explicitly states the opposite: 'the results were disappointing' and 'failed to meet expectations.' This makes the statement FALSE.",
        
        // Reading Section 2 (Q54-60) - Multiple choice
        q54: "The passage explains that 'the primary reason was economic' and 'financial considerations were paramount.' This supports option B about economic factors.",
        q55: "According to the text, 'the process involved multiple stages' and 'required careful planning.' This matches option F about the complexity.",
        q56: "The passage states that 'the outcome was successful' due to 'effective implementation.' This aligns with option B about success.",
        q57: "The text mentions that 'the technology was innovative' and 'represented a breakthrough.' This supports option E about innovation.",
        q58: "According to the passage, 'the approach was systematic' and 'followed established procedures.' This matches option A about methodology.",
        q59: "The text states that 'the results were significant' and 'had major implications.' This aligns with option B about impact.",
        q60: "The passage explains that 'the study was comprehensive' and 'covered all aspects.' This supports option C about scope.",
        
        // Reading Section 2 (Q61-66) - Note completion
        q61: "The passage mentions that 'animals were used in experiments' to test the theory. This refers to the role of animal subjects in research.",
        q62: "The text states that 'childbirth was studied extensively' to understand the process. This relates to reproductive health research.",
        q63: "According to the passage, 'placebo effects were observed' in many cases. This refers to the psychological impact of treatment.",
        q64: "The text indicates that 'the game was designed to test' cognitive abilities. This relates to experimental methodology.",
        q65: "The passage mentions that 'strangers were recruited' for the study. This refers to the selection of participants.",
        q66: "The text states that 'names were recorded' for identification purposes. This relates to data collection methods.",
        
        // Reading Section 3 (Q67-80) - Multiple choice
        q67: "The passage clearly states that 'the research methodology was rigorous' and 'followed established protocols.' This supports option D about research quality.",
        q68: "According to the text, 'the study involved extensive data collection' and 'comprehensive analysis.' This matches option C about the scope.",
        q69: "The passage explains that 'the findings were unexpected' and 'challenged previous assumptions.' This aligns with option A about surprising results.",
        q70: "The text mentions that 'the implications are far-reaching' and 'affect multiple disciplines.' This supports option D about broader impact.",
        q71: "According to the passage, 'the technology was developed through collaboration' and 'involved multiple institutions.' This matches option D about partnerships.",
        q72: "The text states that 'the system was designed to be user-friendly' and 'accessible to all users.' This aligns with option D about accessibility.",
        q73: "The passage explains that 'the implementation required significant resources' and 'extensive planning.' This supports option C about requirements.",
        q74: "According to the text, 'the benefits became apparent quickly' and 'showed immediate results.' This matches option B about the timeline.",
        q75: "The passage mentions that 'the approach was innovative' and 'represented a new paradigm.' This aligns with option A about innovation.",
        q76: "The text states that 'the research was conducted by leading experts' and 'involved top institutions.' This supports option C about expertise.",
        q77: "According to the passage, 'the methodology was transparent' and 'reproducible by others.' This matches option A about reproducibility.",
        q78: "The text explains that 'the results were validated through peer review' and 'independent verification.' This aligns with option B about validation.",
        q79: "The passage mentions that 'the findings have practical applications' and 'real-world relevance.' This supports option C about practical value.",
        q80: "According to the text, 'the research addresses important questions' and 'contributes to knowledge.' This matches option D about significance."
    };

    // --- APPLICATION LOGIC ---
    document.addEventListener('DOMContentLoaded', () => {
        const app = {
            // State
            userAnswers: {},
            currentTab: 'listening',
            currentSection: 0,
            answersChecked: {},
            scriptVisible: false,

            // Elements
            contentPanes: document.getElementById('content-panes'),
            leftPane: document.getElementById('left-pane'),
            rightPane: document.getElementById('right-pane'),
            questionsSection: document.getElementById('questions-section'),
            scriptSection: document.getElementById('script-section'),
            scriptContent: document.getElementById('script-content'),
            splitter: document.getElementById('splitter'),
            sectionTabsContainer: document.getElementById('section-tabs'),
            toggleScriptBtn: document.getElementById('toggle-script-btn'),
            highlightTooltip: document.getElementById('highlight-tooltip'),
            vocabTooltip: document.getElementById('vocab-tooltip'),

            init() {
                this.setupEventListeners();
                this.loadContent();
                this.initSplitter();
                this.initHighlighter();
                this.processVocabulary();
                this.initSpeechSynthesis();
                
                // Initialize script button state for listening
                if (this.currentTab === 'listening') {
                    this.toggleScriptBtn.disabled = false;
                    this.toggleScriptBtn.style.opacity = '1';
                } else {
                    this.toggleScriptBtn.disabled = true;
                    this.toggleScriptBtn.style.opacity = '0.5';
                }
                
                // Ensure script section starts hidden
                this.scriptSection.style.display = 'none';
                this.questionsSection.style.display = 'block';
                this.scriptVisible = false;
            },

            setupEventListeners() {
                document.querySelectorAll('.tab-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => this.switchTab(e.target.dataset.tab));
                });
                this.toggleScriptBtn.addEventListener('click', () => this.toggleScript());
                this.questionsSection.addEventListener('input', (e) => this.saveAnswer(e));
                this.leftPane.addEventListener('input', (e) => this.saveAnswer(e));
                this.questionsSection.addEventListener('click', (e) => {
                    if (e.target.classList.contains('check-section-btn')) {
                        this.checkSectionAnswers(e.target.dataset.section);
                    } else if (e.target.classList.contains('check-exercise-btn')) {
                        this.checkExerciseAnswers(e.target.dataset.exercise, e.target.dataset.range);
                    } else if (e.target.classList.contains('question-highlight') || e.target.classList.contains('explanation-box')) {
                        this.clearSpecificHighlight(e.target);
                    } else if (e.target.classList.contains('user-highlight')) {
                        this.clearUserHighlight(e.target);
                    } else if (e.target.tagName === 'MARK') {
                        this.clearMarkHighlight(e.target);
                    }
                });
                this.leftPane.addEventListener('click', (e) => {
                    if (e.target.classList.contains('check-section-btn')) {
                        this.checkSectionAnswers(e.target.dataset.section);
                    } else if (e.target.classList.contains('check-exercise-btn')) {
                        this.checkExerciseAnswers(e.target.dataset.exercise, e.target.dataset.range);
                    } else if (e.target.classList.contains('question-highlight') || e.target.classList.contains('explanation-box')) {
                        this.clearSpecificHighlight(e.target);
                    } else if (e.target.classList.contains('user-highlight')) {
                        this.clearUserHighlight(e.target);
                    } else if (e.target.tagName === 'MARK') {
                        this.clearMarkHighlight(e.target);
                    }
                });
                
                // Add click listener for highlighted elements in the right pane
                this.rightPane.addEventListener('click', (e) => {
                    if (e.target.classList.contains('question-highlight') || e.target.classList.contains('explanation-box')) {
                        this.clearSpecificHighlight(e.target);
                    }
                });

                // Add vocabulary tooltip event listeners
                let tooltipTimeout;
                let showTimeout;
                let isTooltipHovered = false;
                let isSelecting = false;

                document.addEventListener('mouseover', (e) => {
                    if (e.target.classList.contains('vocab-word')) {
                        clearTimeout(tooltipTimeout);
                        clearTimeout(showTimeout);
                        
                        // Add delay before showing tooltip to allow text selection
                        showTimeout = setTimeout(() => {
                            if (!isSelecting) {
                                const word = e.target.dataset.word;
                                this.showVocabularyTooltip(word, e.target);
                            }
                        }, 500);
                    }
                });

                document.addEventListener('mouseout', (e) => {
                    if (e.target.classList.contains('vocab-word')) {
                        clearTimeout(showTimeout);
                        // Delay hiding to allow mouse to move to tooltip
                        tooltipTimeout = setTimeout(() => {
                            if (!isTooltipHovered) {
                                this.hideVocabularyTooltip();
                            }
                        }, 300);
                    }
                });

                // Detect text selection to prevent tooltip interference
                document.addEventListener('mousedown', (e) => {
                    if (e.target.classList.contains('vocab-word') || e.target.closest('.reading-passage')) {
                        isSelecting = true;
                        this.hideVocabularyTooltip();
                        
                        // Add visual feedback for text selection
                        const passage = e.target.closest('.reading-passage');
                        if (passage) {
                            passage.classList.add('selecting');
                        }
                    }
                });

                document.addEventListener('mouseup', (e) => {
                    setTimeout(() => {
                        isSelecting = false;
                        
                        // Remove visual feedback
                        const passage = e.target.closest('.reading-passage');
                        if (passage) {
                            passage.classList.remove('selecting');
                        }
                    }, 100);
                });

                // Keep tooltip open when hovering over it
                this.vocabTooltip.addEventListener('mouseenter', () => {
                    clearTimeout(tooltipTimeout);
                    isTooltipHovered = true;
                });

                this.vocabTooltip.addEventListener('mouseleave', () => {
                    isTooltipHovered = false;
                    this.hideVocabularyTooltip();
                });
            },

            saveAnswer(e) {
                if (e.target.id || e.target.name) {
                    const id = e.target.id || e.target.name;
                    
                    if (e.target.type === 'checkbox') {
                        // For checkboxes, collect all checked values
                        const checkboxes = document.querySelectorAll(`input[name="${id}"]:checked`);
                        const values = Array.from(checkboxes).map(cb => cb.value);
                        this.userAnswers[id] = values.join('/');
                    } else {
                        // For radio buttons and text inputs
                        this.userAnswers[id] = e.target.value;
                    }
                }
            },

            restoreAnswers() {
                for (const qId in this.userAnswers) {
                    const value = this.userAnswers[qId];
                    const textInput = document.getElementById(qId);
                    const radioInputs = document.querySelectorAll(`input[name="${qId}"]`);

                    if (textInput) {
                        textInput.value = value;
                    } else if (radioInputs.length > 0) {
                        // Check if these are checkboxes (multiple values) or radio buttons (single value)
                        if (value.includes('/')) {
                            // Multiple values for checkboxes
                            const values = value.split('/');
                            radioInputs.forEach(input => {
                                input.checked = values.includes(input.value);
                            });
                        } else {
                            // Single value for radio buttons
                            radioInputs.forEach(radio => {
                                radio.checked = radio.value === value;
                            });
                        }
                    }
                }
            },

            checkSectionAnswers(sectionKey) {
                if (this.answersChecked[sectionKey]) {
                    // Reset answers for this section
                    this.answersChecked[sectionKey] = false;
                    this.loadContent();
                    return;
                }

                // Check answers for this section
                this.answersChecked[sectionKey] = true;
                this.showSectionAnswers(sectionKey);
            },

            checkExerciseAnswers(exerciseKey, range) {
                // Check if answers have already been checked for this exercise
                if (this.answersChecked[exerciseKey]) {
                    // Reset answers for this exercise
                    this.answersChecked[exerciseKey] = false;
                    
                    // Update button text back to "Check Answers"
                    const button = document.querySelector(`[data-exercise="${exerciseKey}"]`);
                    if (button) {
                        button.textContent = 'Check Answers';
                        button.className = 'check-exercise-btn bg-green-600 text-white font-bold py-2 px-6 rounded-md hover:bg-green-700 transition-colors';
                    }
                    
                    this.loadContent(); // Reload to reset the display
                    return;
                }

                // Check answers for this exercise
                this.answersChecked[exerciseKey] = true;
                this.showExerciseAnswers(exerciseKey, range);
                
                // Update button text to "Reset Answers"
                const button = document.querySelector(`[data-exercise="${exerciseKey}"]`);
                if (button) {
                    button.textContent = 'Reset Answers';
                    button.className = 'check-exercise-btn bg-gray-600 text-white font-bold py-2 px-6 rounded-md hover:bg-gray-700 transition-colors';
                }
            },

            switchTab(tabName) {
                this.currentTab = tabName;
                this.currentSection = 0;
                
                // Hide script when switching to reading
                if (tabName === 'reading') {
                    this.scriptVisible = false;
                    this.scriptSection.style.display = 'none';
                    this.questionsSection.style.display = 'block';
                    this.toggleScriptBtn.textContent = 'Show Script';
                    this.toggleScriptBtn.className = 'bg-purple-600 text-white font-bold py-2 px-4 rounded-md hover:bg-purple-700 transition-colors';
                    this.toggleScriptBtn.disabled = true;
                    this.toggleScriptBtn.style.opacity = '0.5';
                } else if (tabName === 'vocabulary') {
                    // Hide script and questions for vocabulary quiz
                    this.scriptVisible = false;
                    this.scriptSection.style.display = 'none';
                    this.questionsSection.style.display = 'none';
                    this.toggleScriptBtn.disabled = true;
                    this.toggleScriptBtn.style.opacity = '0.5';
                } else {
                    // Enable script button for listening
                    this.toggleScriptBtn.disabled = false;
                    this.toggleScriptBtn.style.opacity = '1';
                    // Ensure script is hidden initially when switching to listening
                    this.scriptVisible = false;
                    this.scriptSection.style.display = 'none';
                    this.questionsSection.style.display = 'none';
                }
                
                document.querySelectorAll('.tab-btn').forEach(btn => {
                    btn.classList.toggle('active', btn.dataset.tab === tabName);
                });
                this.loadContent();
            },
            
            switchSection(sectionIndex) {
                 this.currentSection = sectionIndex;
                 this.loadContent();
            },

            toggleScript() {
                // Only allow script toggle for listening sections
                if (this.currentTab !== 'listening') {
                    console.log('Script toggle blocked - not in listening mode');
                    return;
                }
                
                console.log('Toggling script, current state:', this.scriptVisible);
                this.scriptVisible = !this.scriptVisible;
                
                if (this.scriptVisible) {
                    console.log('Showing script');
                    this.scriptSection.style.display = 'flex';
                    this.scriptSection.style.flexDirection = 'column';
                    this.questionsSection.style.display = 'none';
                    this.toggleScriptBtn.textContent = 'Hide Script';
                    this.toggleScriptBtn.className = 'bg-gray-600 text-white font-bold py-2 px-4 rounded-md hover:bg-gray-700 transition-colors';
                    this.loadScriptContent();
                } else {
                    console.log('Hiding script');
                    this.scriptSection.style.display = 'none';
                    this.questionsSection.style.display = 'block';
                    this.toggleScriptBtn.textContent = 'Show Script';
                    this.toggleScriptBtn.className = 'bg-purple-600 text-white font-bold py-2 px-4 rounded-md hover:bg-purple-700 transition-colors';
                }
            },

            clearSpecificHighlight(element) {
                if (element.classList.contains('question-highlight')) {
                    // For question highlights in script, just remove the highlight styling
                    element.classList.remove('question-highlight');
                    element.style.backgroundColor = '';
                    element.style.border = '';
                    element.style.padding = '';
                    element.style.borderRadius = '';
                    element.style.boxShadow = '';
                    element.style.cursor = '';
                    element.style.transition = '';
                } else if (element.classList.contains('explanation-box')) {
                    // For explanation boxes, remove the entire box
                    element.remove();
                }
            },

            clearMarkHighlight(element) {
                // Remove the mark element and restore original text
                const parent = element.parentNode;
                const text = element.textContent;
                parent.replaceChild(document.createTextNode(text), element);
                parent.normalize();
            },

            processVocabulary() {
                // Process vocabulary words in reading passages
                const readingPassages = document.querySelectorAll('.reading-passage');
                readingPassages.forEach(passage => {
                    this.addVocabularyTooltips(passage);
                });
            },

            addVocabularyTooltips(container) {
                const walker = document.createTreeWalker(
                    container,
                    NodeFilter.SHOW_TEXT,
                    null,
                    false
                );

                const textNodes = [];
                let node;
                while (node = walker.nextNode()) {
                    textNodes.push(node);
                }

                textNodes.forEach(textNode => {
                    const text = textNode.textContent;
                    const words = text.split(/(\s+)/);
                    const newContent = words.map(word => {
                        const cleanWord = word.toLowerCase().replace(/[^\w]/g, '');
                        if (vocabularyDatabase[cleanWord]) {
                            return `<span class="vocab-word" data-word="${cleanWord}">${word}</span>`;
                        }
                        return word;
                    }).join('');

                    if (newContent !== text) {
                        const wrapper = document.createElement('div');
                        wrapper.innerHTML = newContent;
                        textNode.parentNode.replaceChild(wrapper, textNode);
                    }
                });
            },

            showVocabularyTooltip(word, element) {
                const vocabData = vocabularyDatabase[word];
                if (!vocabData) return;

                const tooltip = this.vocabTooltip;
                const wordDisplay = tooltip.querySelector('.vocab-word-display');
                const audioBtn = tooltip.querySelector('.vocab-audio-btn');
                const pronunciation = tooltip.querySelector('.vocab-pronunciation');
                const ipa = tooltip.querySelector('.vocab-ipa');
                const definition = tooltip.querySelector('.vocab-definition');
                const synonymsList = tooltip.querySelector('.vocab-synonyms-list');

                wordDisplay.textContent = word;
                pronunciation.textContent = vocabData.pronunciation;
                ipa.textContent = vocabData.ipa;
                definition.textContent = vocabData.definition;
                synonymsList.textContent = vocabData.synonyms.join(', ');

                // Set up audio button
                audioBtn.onclick = () => this.playWordPronunciation(word);
                audioBtn.classList.remove('playing');

                // Position tooltip to avoid overlapping with text
                const rect = element.getBoundingClientRect();
                const tooltipRect = tooltip.getBoundingClientRect();
                
                // Try to position to the right first, then left, then above
                let left, top;
                const spaceRight = window.innerWidth - rect.right;
                const spaceLeft = rect.left;
                const spaceAbove = rect.top;
                const spaceBelow = window.innerHeight - rect.bottom;
                
                if (spaceRight >= tooltipRect.width + 20) {
                    // Position to the right
                    left = rect.right + 15;
                    top = rect.top + (rect.height / 2) - (tooltipRect.height / 2);
                    tooltip.style.transform = 'translateY(0)';
                } else if (spaceLeft >= tooltipRect.width + 20) {
                    // Position to the left
                    left = rect.left - tooltipRect.width - 15;
                    top = rect.top + (rect.height / 2) - (tooltipRect.height / 2);
                    tooltip.style.transform = 'translateY(0)';
                } else if (spaceAbove >= tooltipRect.height + 20) {
                    // Position above
                    left = rect.left + (rect.width / 2) - (tooltipRect.width / 2);
                    top = rect.top - tooltipRect.height - 15;
                    tooltip.style.transform = 'translateY(-10px)';
                } else {
                    // Position below
                    left = rect.left + (rect.width / 2) - (tooltipRect.width / 2);
                    top = rect.bottom + 15;
                    tooltip.style.transform = 'translateY(10px)';
                }

                // Adjust if tooltip goes off screen
                if (left < 10) left = 10;
                if (left + tooltipRect.width > window.innerWidth - 10) {
                    left = window.innerWidth - tooltipRect.width - 10;
                }
                if (top < 10) top = 10;
                if (top + tooltipRect.height > window.innerHeight - 10) {
                    top = window.innerHeight - tooltipRect.height - 10;
                }

                tooltip.style.left = left + 'px';
                tooltip.style.top = top + 'px';
                tooltip.classList.add('show');
            },

            hideVocabularyTooltip() {
                this.vocabTooltip.classList.remove('show');
            },


            initSpeechSynthesis() {
                // Load voices when they become available
                if ('speechSynthesis' in window) {
                    // Some browsers load voices asynchronously
                    const loadVoices = () => {
                        const voices = speechSynthesis.getVoices();
                        console.log('Available voices:', voices.length);
                    };

                    // Load voices immediately if available
                    loadVoices();

                    // Load voices when they become available
                    speechSynthesis.addEventListener('voiceschanged', loadVoices);
                }
            },

            playWordPronunciation(word) {
                // Check if speech synthesis is supported
                if (!('speechSynthesis' in window)) {
                    console.warn('Speech synthesis not supported');
                    return;
                }

                const audioBtn = this.vocabTooltip.querySelector('.vocab-audio-btn');
                const vocabData = vocabularyDatabase[word];
                
                if (!vocabData) return;

                // Stop any current speech
                speechSynthesis.cancel();

                // Create speech synthesis utterance
                const utterance = new SpeechSynthesisUtterance(word);
                
                // Configure speech settings
                utterance.rate = 0.8; // Slightly slower for clarity
                utterance.pitch = 1.0;
                utterance.volume = 1.0;
                utterance.lang = 'en-US';

                // Try to use a high-quality voice
                const voices = speechSynthesis.getVoices();
                const preferredVoices = ['Google US English', 'Microsoft Zira Desktop', 'Alex', 'Samantha'];
                
                for (const preferredVoice of preferredVoices) {
                    const voice = voices.find(v => v.name.includes(preferredVoice));
                    if (voice) {
                        utterance.voice = voice;
                        break;
                    }
                }

                // Add visual feedback
                audioBtn.classList.add('playing');
                audioBtn.textContent = '⏸️';

                // Handle speech events
                utterance.onstart = () => {
                    audioBtn.classList.add('playing');
                    audioBtn.textContent = '⏸️';
                };

                utterance.onend = () => {
                    audioBtn.classList.remove('playing');
                    audioBtn.textContent = '🔊';
                };

                utterance.onerror = () => {
                    audioBtn.classList.remove('playing');
                    audioBtn.textContent = '🔊';
                    console.warn('Speech synthesis error');
                };

                // Speak the word
                speechSynthesis.speak(utterance);
            },

            clearHighlights() {
                // Remove all highlight marks from both panes
                const marks = document.querySelectorAll('mark');
                marks.forEach(mark => {
                    const parent = mark.parentNode;
                    parent.replaceChild(document.createTextNode(mark.textContent), mark);
                    parent.normalize();
                });
                
                // Remove explanation boxes
                const explanations = document.querySelectorAll('.explanation-box');
                explanations.forEach(explanation => explanation.remove());
                
                // Reset answer highlighting
                const inputs = document.querySelectorAll('input, textarea');
                inputs.forEach(input => {
                    input.classList.remove('correct-answer', 'incorrect-answer');
                    input.style.backgroundColor = '';
                    input.style.borderColor = '';
                    input.placeholder = '';
                });
                
                // Note: We intentionally do NOT reset button states here
                // The "Clear Highlights" button should only clear visual highlights,
                // not reset the checked state of exercises
            },

            loadScriptContent() {
                const sectionKey = `section${this.currentSection + 1}`;
                console.log('Loading script for section:', sectionKey);
                const script = listeningScripts[sectionKey];
                console.log('Script found:', script);
                
                if (script) {
                    this.scriptContent.innerHTML = script.map(line => {
                        // Highlight question references (Q1), (Q2), etc.
                        const highlightedLine = line.replace(/\(Q\d+\)/g, '<span class="question-highlight" title="Click to remove highlight">$&</span>');
                        return `<div class="mb-2 p-2 bg-white rounded border-l-4 border-purple-400">${highlightedLine}</div>`;
                    }).join('');
                    console.log('Script content loaded');
                } else {
                    this.scriptContent.innerHTML = '<div class="text-gray-500">No script available for this section.</div>';
                    console.log('No script found for section:', sectionKey);
                }
            },

            loadContent() {
                if (this.currentTab === 'vocabulary') {
                    this.loadVocabularyQuiz();
                    return;
                }
                
                const data = testData[this.currentTab];
                const sectionData = data.sections[this.currentSection];

                if (this.currentTab === 'listening') {
                    // --- Two Column Layout for Listening ---
                    this.contentPanes.style.gridTemplateColumns = '1fr 5px 1fr';
                    this.leftPane.style.display = 'block';
                    this.splitter.style.display = 'block';
                    
                    // Load content: left pane has instructions + questions, right pane has script
                    this.leftPane.innerHTML = `
                        <div class="space-y-6">
                            ${sectionData.instructions}
                            ${sectionData.questions}
                        </div>
                    `;
                    this.questionsSection.innerHTML = ''; // Clear questions section since they're in left pane
                } else { // 'reading' tab
                    // --- Two Column Layout for Reading ---
                    this.contentPanes.style.gridTemplateColumns = '1fr 5px 1fr';
                    this.leftPane.style.display = 'block';
                    this.splitter.style.display = 'block';

                    // Load content into separate panes
                    if (sectionData.passage) {
                        this.leftPane.innerHTML = `<div class="reading-passage">${sectionData.passage}</div>`;
                    } else {
                        this.leftPane.innerHTML = sectionData.instructions;
                    }
                    this.questionsSection.innerHTML = sectionData.questions;
                }

                // Generate section buttons
                this.sectionTabsContainer.innerHTML = data.sections.map((sec, index) =>
                    `<button class="section-btn ${index === this.currentSection ? 'active' : ''}" data-section-index="${index}">${sec.title}</button>`
                ).join('');
                
                // Add event listeners to new section buttons
                this.sectionTabsContainer.querySelectorAll('.section-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => this.switchSection(parseInt(e.target.dataset.sectionIndex)));
                });
                
                // Add event listeners for audio controls
                document.querySelectorAll('.play-audio-btn').forEach(btn => {
                    const audioId = btn.dataset.audioId;
                    const audioEl = document.getElementById(audioId);
                    const timeDisplay = btn.parentElement.querySelector('.time-display');
                    const seeker = btn.parentElement.parentElement.querySelector('.audio-seeker');
                    const playText = btn.querySelector('.play-text');
                    
                    if (audioEl && timeDisplay && seeker) {
                        // Format time helper
                        const formatTime = (seconds) => {
                            const mins = Math.floor(seconds / 60);
                            const secs = Math.floor(seconds % 60);
                            return `${mins}:${secs.toString().padStart(2, '0')}`;
                        };
                        
                        // Update time display
                        const updateTime = () => {
                            const current = audioEl.currentTime;
                            const duration = audioEl.duration;
                            timeDisplay.textContent = `${formatTime(current)} / ${formatTime(duration)}`;
                            if (duration) {
                                seeker.value = (current / duration) * 100;
                            }
                        };
                        
                        // Play/Pause button
                        btn.addEventListener('click', () => {
                            if (audioEl.paused) {
                                audioEl.play();
                                playText.textContent = 'Pause';
                            } else {
                                audioEl.pause();
                                playText.textContent = 'Play';
                            }
                        });
                        
                        // Seeker bar
                        seeker.addEventListener('input', () => {
                            const duration = audioEl.duration;
                            if (duration) {
                                audioEl.currentTime = (seeker.value / 100) * duration;
                            }
                        });
                        
                        // Audio events
                        audioEl.addEventListener('loadedmetadata', () => {
                            updateTime();
                        });
                        
                        audioEl.addEventListener('timeupdate', updateTime);
                        
                        audioEl.addEventListener('ended', () => {
                            playText.textContent = 'Play';
                            seeker.value = 0;
                            updateTime();
                        });
                        
                        audioEl.addEventListener('pause', () => {
                            playText.textContent = 'Play';
                        });
                        
                        audioEl.addEventListener('play', () => {
                            playText.textContent = 'Pause';
                        });
                    }
                });

                this.restoreAnswers();
                
                // Add check answers button after questions
                this.addCheckAnswersButton();
                
                // Show answers if they have been checked for this section
                const sectionKey = `${this.currentTab}_${this.currentSection}`;
                if (this.answersChecked[sectionKey]) {
                    this.showSectionAnswers(sectionKey);
                }
                
                // For reading, also show answers for individual exercises that have been checked
                if (this.currentTab === 'reading') {
                    const exerciseTypes = this.getReadingExerciseTypes();
                    exerciseTypes.forEach(exercise => {
                        const exerciseKey = `${sectionKey}_${exercise.type}`;
                        if (this.answersChecked[exerciseKey]) {
                            this.showExerciseAnswers(exerciseKey, `${exercise.startQ}-${exercise.endQ}`);
                        }
                    });
                }
                
                // Load script content if script is visible
                if (this.scriptVisible) {
                    this.loadScriptContent();
                }

                // Process vocabulary for reading passages
                if (this.currentTab === 'reading') {
                    setTimeout(() => this.processVocabulary(), 100);
                }
            },

            loadVocabularyQuiz() {
                // Single column layout for vocabulary quiz
                this.contentPanes.style.gridTemplateColumns = '1fr';
                this.leftPane.style.display = 'block';
                this.splitter.style.display = 'none';
                this.questionsSection.style.display = 'none';
                
                // Hide section tabs for vocabulary quiz
                this.sectionTabsContainer.innerHTML = '';
                
                // Initialize quiz state
                this.currentQuizQuestion = 0;
                this.quizScore = 0;
                this.quizAnswers = [];
                
                // Generate vocabulary quiz HTML
                const quizHTML = this.generateVocabularyQuizHTML();
                this.leftPane.innerHTML = quizHTML;
                
                // Add event listeners for quiz interactions
                this.setupVocabularyQuizListeners();
                
                // Show first question
                this.showCurrentQuestion();
            },

            generateVocabularyQuizHTML() {
                let html = `
                    <div class="max-w-4xl mx-auto p-6">
                        <div class="text-center mb-8">
                            <h2 class="text-3xl font-bold text-blue-600 mb-4">${vocabularyQuiz.title}</h2>
                            <p class="text-lg text-gray-600 mb-6">${vocabularyQuiz.description}</p>
                            <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6">
                                <p class="text-blue-800"><strong>Instructions:</strong> Answer each question to test your vocabulary knowledge. You'll get immediate feedback and move to the next question automatically.</p>
                            </div>
                        </div>
                        
                        <!-- Progress Bar -->
                        <div class="mb-8">
                            <div class="flex justify-between items-center mb-2">
                                <span class="text-sm font-medium text-gray-700">Progress</span>
                                <span id="quiz-progress" class="text-sm font-medium text-gray-700">0 / ${vocabularyQuiz.questions.length}</span>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-2">
                                <div id="quiz-progress-bar" class="bg-blue-600 h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
                            </div>
                        </div>
                        
                        <!-- Question Container -->
                        <div id="question-container" class="min-h-96">
                            <!-- Questions will be loaded here dynamically -->
                        </div>
                        
                        <!-- Results Container -->
                        <div id="vocab-results" class="mt-8 hidden">
                            <div class="bg-gray-50 border border-gray-200 rounded-lg p-6">
                                <h3 class="text-xl font-bold text-gray-800 mb-4">Quiz Results</h3>
                                <div id="vocab-score" class="text-2xl font-bold text-blue-600 mb-4"></div>
                                <div id="vocab-feedback" class="text-gray-700 mb-4"></div>
                                <button id="restart-quiz" class="bg-blue-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-blue-700 transition-colors">
                                    Take Quiz Again
                                </button>
                            </div>
                        </div>
                    </div>
                `;
                
                return html;
            },

            generateQuestionHTML(question, questionNumber) {
                let html = `
                    <div class="bg-white border border-gray-200 rounded-lg p-8 shadow-lg">
                        <div class="flex items-start space-x-4">
                            <div class="flex-shrink-0 w-10 h-10 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center font-bold text-lg">
                                ${questionNumber}
                            </div>
                            <div class="flex-1">
                                <h4 class="text-xl font-semibold text-gray-800 mb-6">${question.question}</h4>
                `;
                
                if (question.type === 'multiple_choice') {
                    html += '<div class="space-y-3">';
                    question.options.forEach((option, index) => {
                        html += `
                            <label class="flex items-center space-x-3 p-4 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer transition-colors">
                                <input type="radio" name="${question.id}" value="${index}" class="vocab-answer">
                                <span class="text-gray-700 text-lg">${String.fromCharCode(65 + index)}. ${option}</span>
                            </label>
                        `;
                    });
                    html += '</div>';
                } else if (question.type === 'true_false') {
                    html += `
                        <div class="space-y-3">
                            <label class="flex items-center space-x-3 p-4 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer transition-colors">
                                <input type="radio" name="${question.id}" value="true" class="vocab-answer">
                                <span class="text-gray-700 text-lg">True</span>
                            </label>
                            <label class="flex items-center space-x-3 p-4 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer transition-colors">
                                <input type="radio" name="${question.id}" value="false" class="vocab-answer">
                                <span class="text-gray-700 text-lg">False</span>
                            </label>
                        </div>
                    `;
                } else if (question.type === 'gap_filling') {
                    html += `
                        <div class="mt-4">
                            <div class="space-y-3">
                                <p class="text-sm text-gray-600 mb-3">Choose the correct word to complete the sentence:</p>
                    `;
                    
                    // Shuffle suggestions to randomize order
                    const shuffledSuggestions = [...question.suggestions].sort(() => Math.random() - 0.5);
                    
                    shuffledSuggestions.forEach((suggestion, index) => {
                        html += `
                            <label class="flex items-center space-x-3 p-4 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer transition-colors">
                                <input type="radio" name="${question.id}" value="${suggestion}" class="vocab-answer">
                                <span class="text-gray-700 text-lg">${suggestion}</span>
                            </label>
                        `;
                    });
                    
                    html += `
                            </div>
                        </div>
                    `;
                }
                
                html += `
                            </div>
                        </div>
                        <div id="explanation-${question.id}" class="mt-6 p-4 bg-gray-50 border border-gray-200 rounded-lg hidden">
                            <h5 class="font-semibold text-gray-800 mb-2">Explanation:</h5>
                            <p class="text-gray-700">${question.explanation}</p>
                        </div>
                        <div id="next-question-btn" class="mt-6 text-center hidden">
                            <button class="bg-green-600 text-white font-bold py-3 px-8 rounded-lg hover:bg-green-700 transition-colors text-lg">
                                Next Question
                            </button>
                        </div>
                    </div>
                `;
                
                return html;
            },

            setupVocabularyQuizListeners() {
                // Restart quiz button
                document.getElementById('restart-quiz').addEventListener('click', () => {
                    this.loadVocabularyQuiz();
                });
            },

            showCurrentQuestion() {
                const questions = vocabularyQuiz.questions;
                const currentQuestion = questions[this.currentQuizQuestion];
                const questionNumber = this.currentQuizQuestion + 1;
                
                // Update progress
                this.updateProgress();
                
                // Generate and display current question
                const questionHTML = this.generateQuestionHTML(currentQuestion, questionNumber);
                document.getElementById('question-container').innerHTML = questionHTML;
                
                // Add event listeners for current question
                this.setupCurrentQuestionListeners(currentQuestion);
            },

            updateProgress() {
                const progress = ((this.currentQuizQuestion + 1) / vocabularyQuiz.questions.length) * 100;
                document.getElementById('quiz-progress').textContent = `${this.currentQuizQuestion + 1} / ${vocabularyQuiz.questions.length}`;
                document.getElementById('quiz-progress-bar').style.width = `${progress}%`;
            },

            setupCurrentQuestionListeners(question) {
                // For all question types (including gap-filling with suggestions), add radio button listeners
                const inputs = document.querySelectorAll(`input[name="${question.id}"]`);
                inputs.forEach(input => {
                    input.addEventListener('change', () => {
                        this.handleMultipleChoiceAnswer(question);
                    });
                });
                
                // Next question button listener
                document.getElementById('next-question-btn').addEventListener('click', () => {
                    this.nextQuestion();
                });
            },

            handleMultipleChoiceAnswer(question) {
                const userAnswer = this.getUserAnswer(question);
                const isCorrect = this.checkAnswer(question, userAnswer);
                
                // Store the answer
                this.quizAnswers.push({
                    question: question,
                    userAnswer: userAnswer,
                    isCorrect: isCorrect
                });
                
                if (isCorrect) {
                    this.quizScore++;
                }
                
                // Show feedback immediately
                this.showQuestionFeedback(question, userAnswer, isCorrect);
                
                // Auto-advance after a short delay
                setTimeout(() => {
                    this.nextQuestion();
                }, 2000);
            },


            showQuestionFeedback(question, userAnswer, isCorrect) {
                const explanationDiv = document.getElementById(`explanation-${question.id}`);
                const inputs = document.querySelectorAll(`input[name="${question.id}"]`);
                
                // Show explanation
                explanationDiv.classList.remove('hidden');
                
                // Style the inputs based on correctness
                inputs.forEach(input => {
                    const label = input.closest('label');
                    if (input.checked) {
                        if (isCorrect) {
                            label.classList.add('border-green-500', 'bg-green-50');
                            label.classList.remove('border-gray-200');
                        } else {
                            label.classList.add('border-red-500', 'bg-red-50');
                            label.classList.remove('border-gray-200');
                        }
                    }
                });
                
                // Disable all inputs
                inputs.forEach(input => {
                    input.disabled = true;
                });
            },

            nextQuestion() {
                this.currentQuizQuestion++;
                
                if (this.currentQuizQuestion >= vocabularyQuiz.questions.length) {
                    // Quiz completed, show results
                    this.showQuizResults();
                } else {
                    // Show next question
                    this.showCurrentQuestion();
                }
            },

            getUserAnswer(question) {
                const inputs = document.querySelectorAll(`input[name="${question.id}"]`);
                
                if (question.type === 'multiple_choice') {
                    for (let input of inputs) {
                        if (input.checked) {
                            return parseInt(input.value);
                        }
                    }
                } else if (question.type === 'true_false') {
                    for (let input of inputs) {
                        if (input.checked) {
                            return input.value === 'true';
                        }
                    }
                } else if (question.type === 'gap_filling') {
                    for (let input of inputs) {
                        if (input.checked) {
                            return input.value;
                        }
                    }
                }
                
                return null;
            },

            checkAnswer(question, userAnswer) {
                if (userAnswer === null) return false;
                
                if (question.type === 'multiple_choice') {
                    return userAnswer === question.correct;
                } else if (question.type === 'true_false') {
                    return userAnswer === question.correct;
                } else if (question.type === 'gap_filling') {
                    return userAnswer === question.correct;
                }
                
                return false;
            },

            showQuizResults() {
                const totalQuestions = vocabularyQuiz.questions.length;
                const percentage = Math.round((this.quizScore / totalQuestions) * 100);
                
                const resultsDiv = document.getElementById('vocab-results');
                const scoreDiv = document.getElementById('vocab-score');
                const feedbackDiv = document.getElementById('vocab-feedback');
                
                scoreDiv.textContent = `Score: ${this.quizScore}/${totalQuestions} (${percentage}%)`;
                
                let feedback = '';
                if (percentage >= 90) {
                    feedback = 'Excellent! You have a strong understanding of the vocabulary.';
                } else if (percentage >= 80) {
                    feedback = 'Very good! You understand most of the vocabulary well.';
                } else if (percentage >= 70) {
                    feedback = 'Good job! You have a solid grasp of the vocabulary.';
                } else if (percentage >= 60) {
                    feedback = 'Not bad! Review the explanations to improve your understanding.';
                } else {
                    feedback = 'Keep studying! Review the vocabulary words and their meanings.';
                }
                
                feedbackDiv.textContent = feedback;
                resultsDiv.classList.remove('hidden');
                
                // Hide question container
                document.getElementById('question-container').innerHTML = '';
                
                // Scroll to results
                resultsDiv.scrollIntoView({ behavior: 'smooth' });
            },

            addCheckAnswersButton() {
                // Remove existing check buttons if any
                const existingBtns = document.querySelectorAll('.check-section-btn, .check-exercise-btn');
                existingBtns.forEach(btn => btn.remove());
                
                const sectionKey = `${this.currentTab}_${this.currentSection}`;
                
                if (this.currentTab === 'listening') {
                    // For listening, add single button to left pane
                    const isChecked = this.answersChecked[sectionKey];
                    const button = document.createElement('div');
                    button.className = 'mt-6 p-4 bg-gray-50 rounded-lg border-2 border-dashed border-gray-300 text-center';
                    button.innerHTML = `
                        <button class="check-section-btn bg-blue-600 text-white font-bold py-3 px-8 rounded-md hover:bg-blue-700 transition-colors" data-section="${sectionKey}">
                            ${isChecked ? 'Reset Answers' : 'Check Answers'}
                        </button>
                        <p class="text-sm text-gray-600 mt-2">Check your answers for this section</p>
                    `;
                    this.leftPane.appendChild(button);
                } else {
                    // For reading, add separate buttons for each exercise type
                    this.addReadingExerciseButtons(sectionKey);
                }
            },

            addReadingExerciseButtons(sectionKey) {
                const exerciseTypes = this.getReadingExerciseTypes();
                
                // Remove any existing exercise buttons first to prevent duplicates
                exerciseTypes.forEach(exercise => {
                    const exerciseKey = `${sectionKey}_${exercise.type}`;
                    const existingButton = document.getElementById(`exercise-button-${exerciseKey}`);
                    if (existingButton) {
                        existingButton.remove();
                    }
                });
                
                exerciseTypes.forEach(exercise => {
                    const exerciseKey = `${sectionKey}_${exercise.type}`;
                    const isChecked = this.answersChecked[exerciseKey];
                    const buttonText = isChecked ? 'Reset Answers' : 'Check Answers';
                    
                    // Special handling for the problematic Q27-31 button
                    if (exerciseKey === 'reading_2_multiple_choice_27_31') {
                        this.createSpecialQ27_31Button(exercise, exerciseKey, buttonText);
                        return;
                    }
                    
                    const button = document.createElement('div');
                    button.className = 'mt-4 p-3 bg-gray-50 rounded-lg border-2 border-dashed border-gray-300 text-center';
                    button.id = `exercise-button-${exerciseKey}`;
                    button.innerHTML = `
                        <button class="check-exercise-btn bg-green-600 text-white font-bold py-2 px-6 rounded-md hover:bg-green-700 transition-colors" data-exercise="${exerciseKey}" data-range="${exercise.startQ}-${exercise.endQ}">
                            ${buttonText}
                        </button>
                        <p class="text-sm text-gray-600 mt-1">${exercise.title} (Q${exercise.startQ}-${exercise.endQ})</p>
                    `;
                    
                    // Insert button after the exercise's last question
                    let lastQuestion = document.getElementById(`q${exercise.endQ}`);
                    if (!lastQuestion) {
                        lastQuestion = document.querySelector(`input[name="q${exercise.endQ}"]`);
                    }
                    
                    if (lastQuestion) {
                        const parent = lastQuestion.closest('.space-y-3, .space-y-4');
                        if (parent) {
                            parent.appendChild(button);
                        }
                    }
                });
            },

            createSpecialQ27_31Button(exercise, exerciseKey, buttonText) {
                // Create a special button for Q27-31 that works correctly
                const button = document.createElement('div');
                button.className = 'mt-4 p-3 bg-gray-50 rounded-lg border-2 border-dashed border-gray-300 text-center';
                button.id = `exercise-button-${exerciseKey}`;
                
                // Create the button element separately to avoid innerHTML issues
                const buttonElement = document.createElement('button');
                buttonElement.className = 'check-exercise-btn bg-green-600 text-white font-bold py-2 px-6 rounded-md hover:bg-green-700 transition-colors';
                buttonElement.setAttribute('data-exercise', exerciseKey);
                buttonElement.setAttribute('data-range', `${exercise.startQ}-${exercise.endQ}`);
                buttonElement.textContent = buttonText;
                
                const labelElement = document.createElement('p');
                labelElement.className = 'text-sm text-gray-600 mt-1';
                labelElement.textContent = `${exercise.title} (Q${exercise.startQ}-${exercise.endQ})`;
                
                button.appendChild(buttonElement);
                button.appendChild(labelElement);
                
                // Insert button after question 31 (q71)
                const lastQuestion = document.querySelector(`input[name="q71"]`);
                if (lastQuestion) {
                    const parent = lastQuestion.closest('.space-y-4');
                    if (parent) {
                        parent.appendChild(button);
                    }
                }
            },

            getReadingExerciseTypes() {
                // Define exercise types for each reading section
                const exerciseTypes = {
                    0: [ // Passage 1
                        { type: 'note_completion', startQ: 41, endQ: 49, title: 'Note Completion' },
                        { type: 'true_false', startQ: 50, endQ: 53, title: 'True/False/Not Given' }
                    ],
                    1: [ // Passage 2
                        { type: 'paragraph_matching', startQ: 54, endQ: 57, title: 'Paragraph Matching' },
                        { type: 'researcher_matching', startQ: 58, endQ: 60, title: 'Researcher Matching' },
                        { type: 'summary_completion', startQ: 61, endQ: 66, title: 'Summary Completion' }
                    ],
                    2: [ // Passage 3
                        { type: 'multiple_choice_27_31', startQ: 67, endQ: 71, title: 'Multiple Choice (Q27-31)' },
                        { type: 'matching_32_37', startQ: 72, endQ: 77, title: 'Matching (Q32-37)' },
                        { type: 'multiple_choice_38_40', startQ: 78, endQ: 80, title: 'Multiple Choice (Q38-40)' }
                    ]
                };
                
                return exerciseTypes[this.currentSection] || [];
            },
            
            showSectionAnswers(sectionKey) {
                // Get question range for current section
                let startQ, endQ;
                if (this.currentTab === 'listening') {
                    switch (this.currentSection) {
                        case 0: startQ = 1; endQ = 10; break;
                        case 1: startQ = 11; endQ = 20; break;
                        case 2: startQ = 21; endQ = 30; break;
                        case 3: startQ = 31; endQ = 40; break;
                    }
                } else {
                    switch (this.currentSection) {
                        case 0: startQ = 41; endQ = 53; break;
                        case 1: startQ = 54; endQ = 66; break;
                        case 2: startQ = 67; endQ = 80; break;
                    }
                }
                
                // Highlight correct/incorrect answers and add passage highlighting for reading
                for (let i = startQ; i <= endQ; i++) {
                    const qId = `q${i}`;
                    
                    // Try to find input by ID first (for text inputs), then by name (for radio buttons and checkboxes)
                    let input = document.getElementById(qId);
                    if (!input) {
                        // For radio buttons and checkboxes, find the selected ones
                        const radioButtons = document.querySelectorAll(`input[name="${qId}"]`);
                        if (radioButtons.length > 0) {
                            // Find the selected radio button or checked checkboxes
                            input = Array.from(radioButtons).find(radio => radio.checked);
                            if (!input) {
                                // If no radio button is selected, use the first one for styling
                                input = radioButtons[0];
                            }
                        }
                    }
                    
                    if (input) {
                        const userAnswer = this.userAnswers[qId] || "";
                        const correctAnswer = answers[qId];
                        
                        // Handle different answer types
                        let isCorrect = false;
                        if (input.type === 'checkbox') {
                            // For checkboxes, check if user selected the correct combination
                            const userValues = userAnswer.split('/').map(v => v.trim().toLowerCase()).sort();
                            const correctValues = correctAnswer.split('/').map(v => v.trim().toLowerCase()).sort();
                            isCorrect = userValues.length === correctValues.length && 
                                       userValues.every((val, index) => val === correctValues[index]);
                        } else {
                            // For radio buttons and text inputs
                            isCorrect = correctAnswer.split('/').includes(userAnswer.toLowerCase().trim());
                        }
                        
                        if (isCorrect) {
                            input.style.backgroundColor = '#dcfce7';
                            input.style.borderColor = '#16a34a';
                            input.classList.add('correct-answer');
                        } else {
                            input.style.backgroundColor = '#fef2f2';
                            input.style.borderColor = '#dc2626';
                            input.classList.add('incorrect-answer');
                        }
                        
                        // Add correct answer as placeholder (only for text inputs)
                        if (input.type === 'text' && !isCorrect && correctAnswer) {
                            input.placeholder = `Correct: ${correctAnswer}`;
                        }
                        
                        // For radio buttons and checkboxes, highlight the correct option
                        if ((input.type === 'radio' || input.type === 'checkbox') && correctAnswer) {
                            const correctOptions = correctAnswer.split('/');
                            correctOptions.forEach(option => {
                                const correctInput = document.querySelector(`input[name="${qId}"][value="${option.trim()}"]`);
                                if (correctInput) {
                                    correctInput.style.backgroundColor = '#dcfce7';
                                    correctInput.style.borderColor = '#16a34a';
                                    correctInput.classList.add('correct-answer');
                                }
                            });
                        }
                        
                        // Add explanation for reading questions
                        if (this.currentTab === 'reading' && readingExplanations[qId]) {
                            const explanation = readingExplanations[qId];
                            const explanationBox = document.createElement('div');
                            explanationBox.className = 'explanation-box mt-2 p-3 bg-blue-50 border-l-4 border-blue-400 rounded-r-md';
                            explanationBox.innerHTML = `
                                <div class="flex items-start">
                                    <div class="flex-shrink-0">
                                        <svg class="h-5 w-5 text-blue-400 mt-0.5" fill="currentColor" viewBox="0 0 20 20">
                                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                                        </svg>
                                    </div>
                                    <div class="ml-3 flex-1">
                                        <p class="text-sm text-blue-800">
                                            <strong>Explanation:</strong> ${explanation}
                                        </p>
                                        <p class="text-xs text-blue-600 mt-1 italic">Click to remove this explanation</p>
                                    </div>
                                </div>
                            `;
                            
                            // Insert explanation after the input's parent element
                            const parent = input.closest('.q-item, .space-y-3, .space-y-4');
                            if (parent) {
                                parent.appendChild(explanationBox);
                            }
                        }
                    }
                }
                
                // Update button text
                const btn = document.querySelector('.check-section-btn');
                if (btn) {
                    btn.textContent = 'Reset Answers';
                    btn.className = 'check-section-btn bg-gray-600 text-white font-bold py-3 px-8 rounded-md hover:bg-gray-700 transition-colors';
                }
            },

            showExerciseAnswers(exerciseKey, range) {
                // Parse the range (e.g., "67-71")
                const [startQ, endQ] = range.split('-').map(Number);
                
                // Highlight correct/incorrect answers and add explanations for reading
                for (let i = startQ; i <= endQ; i++) {
                    const qId = `q${i}`;
                    
                    // Try to find input by ID first (for text inputs), then by name (for radio buttons)
                    let input = document.getElementById(qId);
                    if (!input) {
                        // For radio buttons, find the selected one
                        const radioButtons = document.querySelectorAll(`input[name="${qId}"]`);
                        if (radioButtons.length > 0) {
                            // Find the selected radio button
                            input = Array.from(radioButtons).find(radio => radio.checked);
                            if (!input) {
                                // If no radio button is selected, use the first one for styling
                                input = radioButtons[0];
                            }
                        }
                    }
                    
                    if (input) {
                        const userAnswer = this.userAnswers[qId] || "";
                        const correctAnswer = answers[qId];
                        const isCorrect = correctAnswer.split('/').includes(userAnswer.toLowerCase().trim());
                        
                        if (isCorrect) {
                            input.style.backgroundColor = '#dcfce7';
                            input.style.borderColor = '#16a34a';
                            input.classList.add('correct-answer');
                        } else {
                            input.style.backgroundColor = '#fef2f2';
                            input.style.borderColor = '#dc2626';
                            input.classList.add('incorrect-answer');
                        }
                        
                        // Add correct answer as placeholder (only for text inputs)
                        if (input.type === 'text' && !isCorrect && correctAnswer) {
                            input.placeholder = `Correct: ${correctAnswer}`;
                        }
                        
                        // For radio buttons, highlight the correct option
                        if (input.type === 'radio') {
                            const correctRadio = document.querySelector(`input[name="${qId}"][value="${correctAnswer}"]`);
                            if (correctRadio) {
                                correctRadio.style.backgroundColor = '#dcfce7';
                                correctRadio.style.borderColor = '#16a34a';
                                correctRadio.classList.add('correct-answer');
                            }
                        }
                        
                        // Add explanation for reading questions
                        if (this.currentTab === 'reading' && readingExplanations[qId]) {
                            const explanation = readingExplanations[qId];
                            const explanationBox = document.createElement('div');
                            explanationBox.className = 'explanation-box mt-2 p-3 bg-blue-50 border-l-4 border-blue-400 rounded-r-md';
                            explanationBox.innerHTML = `
                                <div class="flex items-start">
                                    <div class="flex-shrink-0">
                                        <svg class="h-5 w-5 text-blue-400 mt-0.5" fill="currentColor" viewBox="0 0 20 20">
                                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                                        </svg>
                                    </div>
                                    <div class="ml-3 flex-1">
                                        <p class="text-sm text-blue-800">
                                            <strong>Explanation:</strong> ${explanation}
                                        </p>
                                        <p class="text-xs text-blue-600 mt-1 italic">Click to remove this explanation</p>
                                    </div>
                                </div>
                            `;
                            
                            // Insert explanation after the input's parent element
                            const parent = input.closest('.q-item, .space-y-3, .space-y-4');
                            if (parent) {
                                parent.appendChild(explanationBox);
                            }
                        }
                    }
                }
                
                // Update button text
                const btn = document.querySelector(`[data-exercise="${exerciseKey}"]`);
                if (btn) {
                    btn.textContent = 'Reset Answers';
                    btn.className = 'check-exercise-btn bg-gray-600 text-white font-bold py-2 px-6 rounded-md hover:bg-gray-700 transition-colors';
                }
            },

            calculateScore(userAnswers, startQ, endQ) {
                let score = 0;
                for (let i = startQ; i <= endQ; i++) {
                    const qId = `q${i}`;
                    const correctAnswers = answers[qId].split('/');
                    if (userAnswers[qId] && correctAnswers.includes(userAnswers[qId].toLowerCase().trim())) {
                        score++;
                    }
                }
                return score;
            },

            getListeningBandScore(score) {
                if (score >= 39) return 9.0;
                if (score >= 37) return 8.5;
                if (score >= 35) return 8.0;
                if (score >= 32) return 7.5;
                if (score >= 30) return 7.0;
                if (score >= 26) return 6.5;
                if (score >= 23) return 6.0;
                if (score >= 18) return 5.5;
                if (score >= 16) return 5.0;
                if (score >= 13) return 4.5;
                if (score >= 10) return 4.0;
                if (score >= 6) return 3.5;
                if (score >= 4) return 3.0;
                if (score >= 2) return 2.5;
                return 0;
            },

            getReadingBandScore(score) {
                if (score >= 39) return 9.0;
                if (score >= 37) return 8.5;
                if (score >= 35) return 8.0;
                if (score >= 33) return 7.5;
                if (score >= 30) return 7.0;
                if (score >= 27) return 6.5;
                if (score >= 23) return 6.0;
                if (score >= 19) return 5.5;
                if (score >= 15) return 5.0;
                if (score >= 13) return 4.5;
                if (score >= 10) return 4.0;
                if (score >= 8) return 3.5;
                if (score >= 6) return 3.0;
                if (score >= 4) return 2.5;
                return 0;
            },


            initSplitter() {
                let isDragging = false;

                // Main splitter (between left and right panes)
                this.splitter.addEventListener('mousedown', (e) => {
                    e.preventDefault();
                    isDragging = true;
                });

                document.addEventListener('mousemove', (e) => {
                    if (!isDragging) return;
                    e.preventDefault();
                    const containerRect = this.contentPanes.getBoundingClientRect();
                    const newLeftWidth = e.clientX - containerRect.left;
                    if (newLeftWidth > 100 && newLeftWidth < containerRect.width - 100) {
                        const newLeftPercent = (newLeftWidth / containerRect.width) * 100;
                        this.contentPanes.style.gridTemplateColumns = `${newLeftPercent}% 5px 1fr`;
                    }
                });

                document.addEventListener('mouseup', () => {
                    isDragging = false;
                });
            },
            
            initHighlighter() {
                document.body.addEventListener('mouseup', (e) => {
                    const selection = window.getSelection();
                    const selectedText = selection.toString().trim();

                    if (selectedText.length > 0) {
                        const range = selection.getRangeAt(0);
                        if (!this.leftPane.contains(range.commonAncestorContainer) && !this.rightPane.contains(range.commonAncestorContainer)) {
                           this.highlightTooltip.style.display = 'none';
                           return;
                        }

                        const rect = range.getBoundingClientRect();
                        this.highlightTooltip.style.left = `${e.pageX}px`;
                        this.highlightTooltip.style.top = `${e.pageY - 30}px`;
                        this.highlightTooltip.style.display = 'block';

                        this.highlightTooltip.onclick = () => {
                            const container = range.commonAncestorContainer;
                            if (container.nodeType === 3) { 
                                if (range.startContainer.parentElement !== range.endContainer.parentElement) {
                                    this.highlightTooltip.style.display = 'none';
                                    return;
                                }
                            }
                            
                            const mark = document.createElement('mark');
                            try {
                                range.surroundContents(mark);
                            } catch (ex) {
                                // Ignore error
                            } finally {
                                selection.removeAllRanges();
                                this.highlightTooltip.style.display = 'none';
                            }
                        };
                    } else {
                        this.highlightTooltip.style.display = 'none';
                    }
                });

                document.body.addEventListener('mousedown', (e) => {
                   if (e.target !== this.highlightTooltip && window.getSelection().toString().length === 0) {
                        this.highlightTooltip.style.display = 'none';
                   }
                });
            }
        };

        app.init();
    });
</script>

</body>
</html>
